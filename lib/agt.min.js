(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},X=[].slice,Y={}.hasOwnProperty,Z=function(a,b){function c(){this.constructor=a}for(var d in b)Y.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};D="undefined"!=typeof module,w={},w.mixins=E={},w.random=G={},w.geom=C={},w.particles=F={actions:{},emitters:{},timers:{},counters:{},initializers:{}},y=D?module.exports=w:window.agt=w,w.CAMEL_CASE="camel",w.SNAKE_CASE="snake",w.deprecated=function(a){var b,c,d,e,f,g,h;return f=function(a){var b,c,d,e,f,g,h;return a.indexOf("@")>0?a.indexOf("</")>0?(e=/<\/([^@]+)@(.)+$/.exec(a),c=e[0],d=e[1],b=e[2]):(f=/@(.)+$/.exec(a),c=f[0],b=f[1]):a.indexOf("(")>0?(g=/at\s+([^\s]+)\s*\(([^\)])+/.exec(a),c=g[0],d=g[1],b=g[2]):(h=/at\s+([^\s]+)/.exec(a),c=h[0],b=h[1]),[d,b]},e=new Error,b="",null!=e.stack&&(g=e.stack.split("\n"),h=f(g[3]),d=h[0],c=h[1],b=d?" (called from "+d+" at "+c+")":"(called from "+c+")"),console.log("DEPRECATION WARNING: "+a+b)},null==Object.getPropertyDescriptor&&(Object.getPropertyDescriptor=null!=Object.getPrototypeOf&&null!=Object.getOwnPropertyDescriptor?function(a,b){var c,d;for(d=a,c=void 0;d&&!(c=Object.getOwnPropertyDescriptor(d,b));)d=("function"==typeof Object.getPrototypeOf?Object.getPrototypeOf(d):void 0)||d.__proto__;return c}:function(){return void 0}),Function.prototype.def=function(a,b){return Object.defineProperty(this.prototype,a,{value:b,configurable:!0,enumerable:!1}),this},Function.prototype.accessor=function(a,b){var c;return c=Object.getPropertyDescriptor(this.prototype,a),null!=c&&(b.get||(b.get=c.get)),null!=c&&(b.set||(b.set=c.set)),Object.defineProperty(this.prototype,a,{get:b.get,set:b.set,configurable:!0,enumerable:!0}),this},Function.prototype.getter=function(a,b){return this.accessor(a,{get:b})},Function.prototype.setter=function(a,b){return this.accessor(a,{set:b})},H=function(a,b,c,d,e){return null!=b.__included__&&W.call(b.__included__,c)>=0?void 0:(b.__super__||(b.__super__=[]),b.__super__.push(d),b.__included__||(b.__included__=[]),b.__included__.push(c),b.__name__=""+e.name+"::"+a)},Function.prototype.include=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(i=1<=arguments.length?X.call(arguments,0):[],e=["constructor","excluded","super"],this.__mixins__||(this.__mixins__=[]),this.__super__||(this.__super__={}),this.__super__=Object.create(this.__super__),n=0,p=i.length;p>n;n++){for(h=i[n],this.__mixins__.push(h),d=e.concat(),null!=h.prototype.excluded&&(d=d.concat(h.prototype.excluded)),g=Object.keys(h.prototype),o=0,q=g.length;q>o;o++)if(f=g[o],W.call(d,f)<0){if(l=Object.getPropertyDescriptor(this.prototype,f),j=Object.getPropertyDescriptor(h.prototype,f),null!=l&&null!=j){if(m=null!=l.get||null!=l.set,k=null!=j.get||null!=j.set,a=null!=l.get&&null!=j.get,b=null!=l.set&&null!=j.set,c=null!=l.value&&null!=j.value,m&&k)a&&H(f,j.get,this,l.get,h),b&&H(f,j.set,this,l.set,h),j.get||(j.get=l.get),j.set||(j.set=l.set);else{if(!c)throw new Error("Can't mix accessors and plain values inheritance");H(f,j.value,this,l.value,h)}Object.defineProperty(this.__super__,f,j)}else null!=j?this.__super__[f]=h[f]:null!=l?Object.defineProperty(this.__super__,f,j):null!=this.prototype[f]&&(H(f,h[f],this,this.prototype[f],h),this.__super__[f]=h[f]);null!=j?Object.defineProperty(this.prototype,f,j):this.prototype[f]=h.prototype[f]}"function"==typeof h.included&&h.included(this)}return this},Function.prototype.extend=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(i=1<=arguments.length?X.call(arguments,0):[],e=["extended","excluded","included"],this.__mixins__||(this.__mixins__=[]),n=0,p=i.length;p>n;n++){for(h=i[n],this.__mixins__.push(h),d=e.concat(),null!=h.excluded&&(d=d.concat(h.excluded)),g=Object.keys(h),o=0,q=g.length;q>o;o++)if(f=g[o],W.call(d,f)<0){if(l=Object.getPropertyDescriptor(this,f),j=Object.getPropertyDescriptor(h,f),null!=l&&null!=j)if(m=null!=l.get||null!=l.set,k=null!=j.get||null!=j.set,a=null!=l.get&&null!=j.get,b=null!=l.set&&null!=j.set,c=null!=l.value&&null!=j.value,m&&k)a&&H(f,j.get,this,l.get,h),b&&H(f,j.set,this,l.set,h),j.get||(j.get=l.get),j.set||(j.set=l.set);else{if(!c)throw new Error("Can't mix accessors and plain values inheritance");H(f,j.value,this,l.value,h)}null!=j?Object.defineProperty(this,f,j):this[f]=h[f]}"function"==typeof h.extended&&h.extended(this)}return this},Function.prototype.concern=function(){var a;return a=1<=arguments.length?X.call(arguments,0):[],this.include.apply(this,a),this.extend.apply(this,a)},z=function(a,b){var c,d,e,f,g;for(e=Object.keys(b),f=0,g=e.length;g>f;f++)if(d=e[f],c=Object.getPropertyDescriptor(b,d),null!=c){if(c.value===a)return{key:d,descriptor:c,kind:"value"};if(c.get===a)return{key:d,descriptor:c,kind:"get"};if(c.set===a)return{key:d,descriptor:c,kind:"set"}}else if(b[d]===a)return{key:d};return{}},null==Object.prototype["super"]&&(Object.defineProperty(Object.prototype,"super",{enumerable:!1,configurable:!0,value:function(){var a,b,c,d,e,f,g,h;if(a=1<=arguments.length?X.call(arguments,0):[],b=null!=(g=arguments.caller)?g:this["super"].caller,null!=b){if(null!=b.__super__){if(f=b.__super__[b.__included__.indexOf(this.constructor)],null!=f){if("function"==typeof f)return f.apply(this,a);throw new Error("The super for "+b._name+" isn't a function")}throw new Error("No super method for "+b._name)}if(h=z(b,this.constructor.prototype),d=h.key,e=h.kind,null!=d)return c=Object.getPropertyDescriptor(this.constructor.__super__,d),f=null!=c?c[e].apply(this,a):this.constructor.__super__[d].apply(this,a);throw new Error("No super method for "+(b.name||b._name))}throw new Error("Super called with a caller")}}),Object.defineProperty(Function.prototype,"super",{enumerable:!1,configurable:!0,value:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(a=1<=arguments.length?X.call(arguments,0):[],b=arguments.caller||this["super"].caller,null!=b){if(null!=b.__super__){if(i=b.__super__[b.__included__.indexOf(this)],null!=i){if("function"==typeof i)return i.apply(this,a);throw new Error("The super for "+b._name+" isn't a function")}throw new Error("No super method for "+b._name)}for(n=z(b,this),d=n.key,e=n.kind,h=[],o=this.__mixins__,j=0,l=o.length;l>j;j++)f=o[j],h.unshift(f);if(null!=d){for(k=0,m=h.length;m>k;k++)if(f=h[k],null!=f[d]){g=f;break}return c=Object.getPropertyDescriptor(g,d),i=null!=c?c[e].apply(this,a):g[d].apply(this,a)}throw new Error("No super class method for "+(b.name||b._name))}throw new Error("super called without a caller")}})),Math.PI2=2*Math.PI,Math.PI_2=Math.PI/2,Math.PI_4=Math.PI/4,Math.PI_8=Math.PI/8,Math.degToRad=function(a){return a*Math.PI/180},Math.radToDeg=function(a){return 180*a/Math.PI},Math.normalize=function(a,b,c){return(a-b)/(c-b)},Math.interpolate=function(a,b,c){return b+(c-b)*a},Math.deltaBelowRatio=function(a,b,c){return null==c&&(c=1e10),Math.abs(a-b)<1/c},Math.map=function(a,b,c,d,e){return Math.interpolate(Math.normalize(a,b,c),d,e)},Math.isFloat=function(){var a,b,c,d;for(b=1<=arguments.length?X.call(arguments,0):[],c=0,d=b.length;d>c;c++)if(a=b[c],isNaN(parseFloat(a)))return!1;return!0},Math.isInt=function(){var a,b,c,d;for(b=1<=arguments.length?X.call(arguments,0):[],c=0,d=b.length;d>c;c++)if(a=b[c],isNaN(parseInt(a)))return!1;return!0},Math.asFloat=function(){var a,b,c,d,e;for(a=1<=arguments.length?X.call(arguments,0):[],b=d=0,e=a.length;e>d;b=++d)c=a[b],a[b]=parseFloat(c);return a},Math.asInt=function(){var a,b,c,d,e;for(b=1<=arguments.length?X.call(arguments,0):[],a=d=0,e=b.length;e>d;a=++d)c=b[a],b[a]=parseInt(c);return b},w.Signal=function(){function a(){var a;a=1<=arguments.length?X.call(arguments,0):[],this.signature=a,this.listeners=[],this.asyncListeners=0}return a.prototype.add=function(a,b,c){return null==c&&(c=0),this.validate(a),this.registered(a,b)?void 0:(this.listeners.push([a,b,!1,c]),this.isAsync(a)&&this.asyncListeners++,this.sortListeners())},a.prototype.addOnce=function(a,b,c){return null==c&&(c=0),this.validate(a),this.registered(a,b)?void 0:(this.listeners.push([a,b,!0,c]),this.isAsync(a)&&this.asyncListeners++,this.sortListeners())},a.prototype.remove=function(a,b){return this.registered(a,b)?(this.isAsync(a)&&this.asyncListeners--,this.listeners.splice(this.indexOf(a,b),1)):void 0},a.prototype.removeAll=function(){return this.listeners=[],this.asyncListeners=0},a.prototype.indexOf=function(a,b){var c,d,e,f,g,h,i;for(h=this.listeners,d=f=0,g=h.length;g>f;d=++f)if(i=h[d],e=i[0],c=i[1],a===e&&b===c)return d;return-1},a.prototype.registered=function(a,b){return-1!==this.indexOf(a,b)},a.prototype.hasListeners=function(){return 0!==this.listeners.length},a.prototype.sortListeners=function(){return this.listeners.length<=1?void 0:this.listeners.sort(function(a,b){var c,d,e;return e=[a[3],b[3]],c=e[0],d=e[1],d>c?1:c>d?-1:0})},a.prototype.validate=function(a){var b,c,d,e,f,g,h;if(this.signature.length>0&&(e=/[^(]+\(([^)]+)\).*$/m,c=Function.prototype.toString.call(a).split("\n").shift(),h=c.replace(e,"$1"),b=h.split(/\s*,\s*/g),""===b[0]&&b.shift(),"callback"===b[b.length-1]&&b.pop(),f=this.signature.join(),g=b.join(),d="The listener "+a+" doesn't match the signal's signature "+f,g!==f))throw new Error(d)},a.prototype.isAsync=function(a){return-1!==Function.prototype.toString.call(a).indexOf("callback)")},a.prototype.dispatch=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(a=2<=arguments.length?X.call(arguments,0,i=arguments.length-1):(i=0,[]),b=arguments[i++],"function"!=typeof b&&(a.push(b),b=null),e=this.listeners.concat(),this.asyncListeners>0)return(f=function(b){return function(c){var d,g,h,i,j;return e.length?(j=e.shift(),g=j[0],d=j[1],h=j[2],i=j[3],b.isAsync(g)?g.apply(d,a.concat(function(){return h&&b.remove(g,d),f(c)})):(g.apply(d,a),h&&b.remove(g,d),f(c))):"function"==typeof c?c():void 0}}(this))(b);for(j=0,k=e.length;k>j;j++)l=e[j],d=l[0],c=l[1],g=l[2],h=l[3],d.apply(c,arguments),g&&this.remove(d,c);return"function"==typeof b?b():void 0},a}(),B="undefined"!=typeof global&&null!==global?global:window,I=B.requestAnimationFrame||B.webkitRequestAnimationFrame||B.mozRequestAnimationFrame||B.oRequestAnimationFrame||B.msRequestAnimationFrame||function(){return B.setTimeout(callback,1e3/60)},w.Impulse=function(a){function b(a){this.timeScale=null!=a?a:1,b.__super__.constructor.call(this),this.running=!1}return Z(b,a),b.instance=function(){return this.__instance__||(this.__instance__=new b)},b.prototype.add=function(a,c,d){return null==d&&(d=0),b.__super__.add.call(this,a,c,d),this.hasListeners()&&!this.running?this.start():void 0},b.prototype.remove=function(a,c,d){return null==d&&(d=0),b.__super__.remove.call(this,a,c,d),this.running&&!this.hasListeners()?this.stop():void 0},b.prototype.hasListeners=function(){return this.listeners.length>0},b.prototype.start=function(){return this.running=!0,this.initRun()},b.prototype.stop=function(){return this.running=!1},b.prototype.initRun=function(){return this.time=this.getTime(),I(function(a){return function(){return a.run()}}(this))},b.prototype.run=function(){var a,b;return this.running?(b=this.getTime(),a=(b-this.time)*this.timeScale,this.dispatch(a,a/1e3,b),this.initRun()):void 0},b.prototype.getTime=function(){return(new Date).getTime()},b}(w.Signal),w.mixins.Activable=function(){function a(){}return a.prototype.active=!1,a.prototype.activate=function(){return this.active?void 0:(this.active=!0,"function"==typeof this.activated?this.activated():void 0)},a.prototype.deactivate=function(){return this.active?(this.active=!1,"function"==typeof this.deactivated?this.deactivated():void 0):void 0},a}(),w.mixins.Aliasable=function(){function a(){}return a.alias=function(){var a,b,c,d,e,f,g,h,i,j;if(d=arguments[0],b=2<=arguments.length?X.call(arguments,1):[],c=Object.getPropertyDescriptor(this.prototype,d),null!=c){for(i=[],e=0,g=b.length;g>e;e++)a=b[e],i.push(Object.defineProperty(this.prototype,a,c));return i}if(null!=this.prototype[d]){for(j=[],f=0,h=b.length;h>f;f++)a=b[f],j.push(this.prototype[a]=this.prototype[d]);return j}},a}(),w.mixins.AlternateCase=function(){function a(){}return a.snakify=function(){return this.convert("toSnakeCase")},a.camelize=function(){return this.convert("toCamelCase")},a.convert=function(a){var b,c,d,e,f,g;f=this.prototype,g=[];for(d in f)e=f[d],b=this[a](d),c=Object.getPropertyDescriptor(this.prototype,d),g.push(null!=c?Object.defineProperty(this.prototype,b,c):this.prototype[b]=e);return g},a.toSnakeCase=function(a){return a.replace(/([a-z])([A-Z])/g,"$1_$2").split(/_+/g).join("_").toLowerCase()},a.toCamelCase=function(a){var b,c,d,e,f;for(b=a.toLowerCase().split(/[_\s-]/),c=b.shift(),e=0,f=b.length;f>e;e++)d=b[e],c=""+c+d.replace(/^./,function(a){return a.toUpperCase()});return c},a}(),x=function(a,b){var c,d,e,f;return c=function(){var a,b;for(b=[],e=a=0;24>=a;e=++a)b.push(new Function("return new arguments[0]("+function(){var a,b;for(b=[],f=a=0;e>=0?e>=a:a>=e;f=e>=0?++a:--a)0!==f&&b.push("arguments[1]["+(f-1)+"]");return b}().join(",")+");"));return b}(),(d=c[null!=b?b.length:0])(a,b)},w.mixins.Cloneable=function(){var a,b;return b=1<=arguments.length?X.call(arguments,0):[],a=function(){function a(){}return a.prototype.clone=function(){return new this.constructor(this)},b.length>0&&(a.prototype.clone=function(){return x(this.constructor,b.map(function(a){return function(b){return a[b]}}(this)))}),a}()},w.mixins.Delegation=function(){function a(){}return a.delegate=function(){var a,b,c,d,e,f;return d=2<=arguments.length?X.call(arguments,0,f=arguments.length-1):(f=0,[]),b=arguments[f++],null==b&&(b={}),a=b.to,c=b.prefix,e=b["case"]||w.CAMEL_CASE,d.forEach(function(b){return function(d){var f;if(f=d,c)switch(e){case w.SNAKE_CASE:f=a+"_"+d;break;case w.CAMEL_CASE:f=a+d.replace(/^./,function(a){return a.toUpperCase()})}return Object.defineProperty(b.prototype,f,{enumerable:!0,configurable:!0,get:function(){return this[a][d]},set:function(b){return this[a][d]=b}})}}(this))},a}(),w.mixins.Equatable=function(){var a,b;return b=1<=arguments.length?X.call(arguments,0):[],a=function(){function a(){}return a.prototype.equals=function(a){return null!=a&&b.every(function(b){return function(c){return null!=b[c].equals?b[c].equals(a[c]):a[c]===b[c]}}(this))},a}()},w.mixins.Formattable=function(){var a,b,c;return b=arguments[0],c=2<=arguments.length?X.call(arguments,1):[],a=function(){function a(){}return a.prototype.toString=function(){return"["+b+"]"},c.length>0&&(a.prototype.toString=function(){var a,d;return a=function(){var a,b,e;for(e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(""+d+"="+this[d]);return e}.call(this),"["+b+"("+a.join(", ")+")]"}),a.prototype.classname=function(){return b},a}()},b=["globalizable","unglobalizable","globalized","globalize","unglobalize","globalizeMember","unglobalizeMember","keepContext","previousValues","previousDescriptors"],w.mixins.Globalizable=function(a,c){var d;return null==c&&(c=!0),d=function(){function d(){}return d.unglobalizable=b.concat(),d.prototype.keepContext=c,d.prototype.globalize=function(){return this.globalized?void 0:(this.previousValues={},this.previousDescriptors={},this.globalizable.forEach(function(a){return function(b){return W.call(a.constructor.unglobalizable||d.unglobalizable,b)<0?a.globalizeMember(b):void 0}}(this)),this.globalized=!0)},d.prototype.unglobalize=function(){return this.globalized?(this.globalizable.forEach(function(a){return function(b){return W.call(a.constructor.unglobalizable||d.unglobalizable,b)<0?a.unglobalizeMember(b):void 0}}(this)),this.previousValues=null,this.previousDescriptors=null,this.globalized=!1):void 0},d.prototype.globalizeMember=function(b){var d,e,f,g,h;return d=Object.getPropertyDescriptor(a,b),e=Object.getPropertyDescriptor(this,b),null!=d?this.previousDescriptors[b]=d:null!=this[b]&&null!=a[b]&&(this.previousValues[b]=a),null!=e?(c&&(null!=e.get||null!=e.set?(e.get=null!=(g=e.get)?g.bind(this):void 0,e.set=null!=(h=e.set)?h.bind(this):void 0):"function"==typeof e.value&&(e.value=e.value.bind(this))),Object.defineProperty(a,b,e)):(f=this[b],"function"==typeof f&&c&&(f=f.bind(this)),Object.defineProperty(a,b,{value:f,enumerable:!0,writable:!0,configurable:!0}))},d.prototype.unglobalizeMember=function(b){return null!=this.previousDescriptors[b]?Object.defineProperty(a,b,this.previousDescriptors[b]):a[b]=null!=this.previousValues[b]?this.previousValues[b]:void 0},d}()},w.mixins.HasAncestors=function(a){var b,c;return null==a&&(a={}),c=a.through||"parent",b=function(){function a(){}return a.getter("ancestors",function(){var a,b;for(a=[],b=this[c];null!=b;)a.push(b),b=b[c];return a}),a.getter("selfAndAncestors",function(){return[this].concat(this.ancestors)}),a.ancestorsScope=function(a,b){return this.getter(a,function(){return this.ancestors.filter(b,this)})},a}()},w.mixins.HasCollection=function(a,b){var c,d,e;return d=a.replace(/^./,function(a){return a.toUpperCase()}),e=b.replace(/^./,function(a){return a.toUpperCase()}),c=function(){function b(){}return b.extend(E.Aliasable),b[""+a+"Scope"]=function(b,c){return this.getter(b,function(){return this[a].filter(c,this)})},b.getter(""+a+"Size",function(){return this[a].length}),b.alias(""+a+"Size",""+a+"Length",""+a+"Count"),b.prototype["has"+e]=function(b){return W.call(this[a],b)>=0},b.alias("has"+e,"contains"+e),b.getter("has"+d,function(){return this[a].length>0}),b.prototype["add"+e]=function(b){return this["has"+e](b)||this[a].push(b),this[""+a+"Size"]},b.prototype["remove"+e]=function(b){return this["has"+e](b)&&this[a].splice(this["find"+e](b),1),this[""+a+"Size"]},b.prototype["find"+e]=function(b){return this[a].indexOf(b)},b.alias("find"+e,"indexOf"+e),b}()},w.mixins.HasNestedCollection=function(a,b){var c,d;if(null==b&&(b={}),d=b.through,null==d)throw new Error("missing through option");return c=function(){function b(){}return b[""+a+"Scope"]=function(b,c){return this.getter(b,function(){return this[a].filter(c,this)})},b.getter(a,function(){var b;return b=[],this[d].forEach(function(c){return b.push(c),null!=c[a]?b=b.concat(c[a]):void 0}),b}),b}()},w.mixins.Memoizable=function(){function a(){}return a.prototype.memoized=function(a){var b;return this.memoizationKey()===this.__memoizationKey__?null!=(null!=(b=this.__memo__)?b[a]:void 0):(this.__memo__={},!1)},a.prototype.memoFor=function(a){return this.__memo__[a]},a.prototype.memoize=function(a,b){return this.__memo__||(this.__memo__={}),this.__memoizationKey__=this.memoizationKey(),this.__memo__[a]=b},a.prototype.memoizationKey=function(){return this.toString()},a}(),w.mixins.Parameterizable=function(a,b,c){var d;return null==c&&(c=!1),d=function(){function d(){}return d.included=function(d){var e;return e=function(){var a,d,e,f,g,h,i,j,k,l,m;a=2<=arguments.length?X.call(arguments,0,m=arguments.length-1):(m=0,[]),j=arguments[m++],"boolean"!=typeof j&&(a.push(j),j=!1),h={},g=arguments[0],f=0,d=null!=g&&"object"==typeof g;for(e in b)if(k=b[e],l=d?g[e]:arguments[f++],i=typeof k,j)if(typeof l===i)h[e]=l;else{if("number"!==i)throw new Error("value for "+e+" doesn't match type "+i);if(l=parseFloat(l),isNaN(l))throw new Error("value for "+e+" doesn't match type "+i);h[e]=l}else null!=l?"number"===i?(l=parseFloat(l),isNaN(l)?c||(h[e]=k):h[e]=l):h[e]=l:c||(h[e]=k);return h},d[a]=e,d.prototype[a]=e},d}()},w.mixins.Poolable=function(){function a(){}return a.extended=function(a){return a.usedInstances=[],a.unusedInstances=[]},a.resetPools=function(){return this.usedInstances=[],this.unusedInstances=[]},a.get=function(a){var b;return null==a&&(a={}),b=this.unusedInstances.length>0?this.unusedInstances.shift():new this,this.usedInstances.push(b),b.init(a),b},a.release=function(a){var b;if(!(W.call(this.usedInstances,a)<0))return b=this.usedInstances.indexOf(a),this.usedInstances.splice(b,1),this.unusedInstances.push(a)},a.prototype.init=function(a){var b,c,d;null==a&&(a={}),d=[];for(b in a)c=a[b],d.push(this[b]=c);return d},a.prototype.dispose=function(){return this.constructor.release(this)},a}(),w.mixins.Sourcable=function(){var a,b,c;return b=arguments[0],c=2<=arguments.length?X.call(arguments,1):[],a=function(){function a(){}var d;return d=function(a){var b;switch(typeof a){case"object":return b=-1!==Object.prototype.toString.call(a).indexOf("Array"),b?"["+a.map(function(a){return d(a)})+"]":null!=a.toSource?a.toSource():a;case"string":return"'"+a.replace("'","\\'")+"'";default:return a}},a.prototype.toSource=function(){var a,e;return e=function(){var b,d,e;for(e=[],b=0,d=c.length;d>b;b++)a=c[b],e.push(this[a]);return e}.call(this).map(function(a){return d(a)}),"new "+b+"("+e.join(",")+")"},a}()},E.Sourcable._name="Sourcable",A=Math.floor,J=Math.round,w.random.Random=function(){function a(a){this.generator=a}return a.include(E.Cloneable("generator")),a.include(E.Sourcable("agt.random.Random","generator")),a.include(E.Formattable("Random","generator")),a.prototype.get=function(){return this.generator.get()},a.prototype.boolean=function(a){return null==a&&(a=.5),a>=0&&1>=a||(a=.5),this.get()<a},a.prototype.bit=function(a){return null==a&&(a=.5),this.boolean(a)?1:0},a.prototype.sign=function(a){return null==a&&(a=.5),this.boolean(a)?1:-1},a.prototype.char=function(a,b){var c,d,e,f,g,h;switch(null==a&&(f=["abcdefghijklmnopqrstuvwxyz",null],a=f[0],b=f[1]),typeof a){case"string":if("string"==typeof b){for(d="",c=e=g=a.charCodeAt(0),h=b.charCodeAt(0);h>=g?h>=e:e>=h;c=h>=g?++e:--e)d+=String.fromCharCode(c);a=d}return a.substr(this.intRandom(a.length-1),1);case"number":return"number"==typeof b?c=String.fromCharCode(A(this.inRange(a,b))):String.fromCharCode(this.intRandom(a))}},a.prototype.inRange=function(a,b,c){var d,e;return e=a+this.random(b-a),"number"==typeof c&&(d=1/c,A(e*d)!==e*d&&(e-=e%c)),e=A(1e9*e)/1e9},a.prototype.inArray=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(null==a)return null;if(null==b)return a[this.intRandom(a.length-1)];if(b.length!==a.length)throw new Error("array and ratios arrays must have the same length");if(c)for(f=l=0,o=b.length;o>l;f=++l)if(e=b[f],f>0&&(d=b[f-1],d>e))throw new Error("ratios must be ordered when summed is true");if(c)g=b[b.length-1],b=b.map(function(a){return a/g});else for(j=b.reduce(function(a,b){return a+b}),b=b.map(function(a){return a/j}),f=m=0,p=b.length;p>m;f=++m)h=b[f],f>0&&(b[f]+=b[f-1]);for(i=this.get(),f=n=0,q=b.length;q>n;f=++n)if(k=b[f],k>=i)return a[f]},a.prototype["in"]=function(a,b,c){if(arguments.length>3)return this.inArray(arguments);switch(typeof a){case"number":return this.inRange(a,b);case"string":return this.inArray(a,b,c);case"object":if("[object Array]"===Object.prototype.toString.call(a))return this.inArray(a,b,c);if(null!=a.min&&null!=a.max)return this.inRange(a.min,a.max,a.step);break;default:return null}},a.prototype.sort=function(){return function(a){return function(){return a.intPad(2)}}(this)},a.prototype.random=function(a){return this.get()*(a||1)},a.prototype.intRandom=function(a){return J(this.random(a))},a.prototype.pad=function(a){return a/2-this.random(a)},a.prototype.intPad=function(a){return J(this.pad(a))},a}(),w.random.LaggedFibonnacci=function(){function a(a){null==a&&(a=0),this.plantSeed(a)}return a.include(E.Cloneable("seed")),a.include(E.Sourcable("chancejs.LaggedFibonnacci","seed")),a.include(E.Formattable("LaggedFibonnacci","seed")),a.prototype.get=function(){var a;return a=this.u[this.i97]-this.u[this.j97],0>a&&(a+=1),this.u[this.i97]=a,--this.i97<0&&(this.i97=96),--this.j97<0&&(this.j97=96),this.c-=this.cd,this.c<0&&(this.c+=this.cm),a-=this.c,0>a&&(a+=1),a},a.prototype.plantSeed=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(null==a&&(a=0),this.u=new Array(97),d=a/30082,h=a-30082*d,b=d/177%177+2,e=d%177+2,g=h/169%178+1,i=h%169,c=m=0;96>=m;c=++m){for(o=[0,.5],k=o[0],l=o[1],f=n=0;23>=n;f=++n)j=b*e%179*g%179,p=[e,g,j],b=p[0],e=p[1],g=p[2],i=(53*i+1)%169,i*j%64>=32&&(k+=l),l*=.5;this.u[c]=k}return this.c=362436/16777216,this.cd=7654321/16777216,this.cm=.9999998211860657,this.i97=96,this.j97=32},a}(),w.random.Linear=function(){function a(a){this.step=null!=a?a:1e9,this.iterator=0}return a.include(E.Cloneable("step")),a.include(E.Sourcable("chancejs.Linear","step")),a.include(E.Formattable("Linear","step")),a.prototype.get=function(){var a;return a=this.iterator++/this.step,this.iterator>this.step&&(this.iterator=0),a},a}(),w.random.LinearCongruential=function(){function a(a){this.seed=null!=a?a:1}return a.include(E.Cloneable("seed")),a.include(E.Sourcable("chancejs.LinearCongruential","seed")),a.include(E.Formattable("LinearCongruential","seed")),a.prototype.plantSeed=function(a){this.seed=null!=a?a:1},a.prototype.get=function(){var a,b,c,d;return d=this.seed,c=d,c<<=1,b=d<<32,a=b+c,2147483648&a&&(a=2147483647&a,a++),this.seed=a,a/2147483648},a}(),w.random.MathRandom=function(){function a(){}return a.include(E.Cloneable()),a.include(E.Sourcable("chancejs.MathRandom")),a.include(E.Formattable("MathRandom")),a.prototype.get=function(){return Math.random()},a}(),w.random.MersenneTwister=function(){function a(a){null==a&&(a=0),this.mt=Array(623),this.z=0,this.y=0,this.plantSeed(a)}return a.include(E.Cloneable("seed")),a.include(E.Sourcable("chancejs.MersenneTwister","seed")),a.include(E.Formattable("MersenneTwister","seed")),a.prototype.plantSeed=function(a){var b,c,d;for(null==a&&(a=0),this.mt[0]=a,d=[],b=c=1;623>=c;b=++c)d.push(this.mt[b]=69069*this.mt[b-1]+1&4294967295);return d},a.prototype.get=function(){return this.z>=623&&this.generateNumbers(),this.extractNumber(this.z++)/2147483648},a.prototype.generateNumbers=function(){var a,b,c;for(this.z=0,c=[],a=b=0;623>=b;a=++b)this.y=2147483648&this.mt[a]+2147483647&this.mt[(a+1)%623],c.push(this.y%2===0?this.mt[a]=this.mt[(a+397)%623]^this.y>>1:this.mt[a]=this.mt[(a+397)%623]^this.y>>1^2567483615);return c},a.prototype.extractNumber=function(a){return this.y=this.mt[a],this.y^=this.y>>11,this.y^=this.y<<7&2636928640,this.y^=this.y<<15&4022730752,this.y^=this.y>>18},a}(),w.random.NoRandom=function(){function a(a){this.seed=null!=a?a:0}return a.include(E.Cloneable("seed")),a.include(E.Sourcable("chancejs.NoRandom","seed")),a.include(E.Formattable("NoRandom","seed")),a.prototype.get=function(){return this.seed},a}(),w.random.PaulHoule=function(){function a(a){this.seed=a}return a.include(E.Cloneable("seed")),a.include(E.Sourcable("chancejs.PaulHoule","seed")),a.include(E.Formattable("PaulHoule","seed")),a.prototype.get=function(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280},a}(),w.geom.Geometry=function(){function a(){}var b;return a.prototype.points=function(){},a.prototype.closedGeometry=function(){return!1},b=function(a,b,c){return Math[b].apply(Math,a.map(function(a){return a[c]}))},a.prototype.top=function(){return b(this.points(),"min","y")},a.prototype.bottom=function(){return b(this.points(),"max","y")},a.prototype.left=function(){return b(this.points(),"min","x")},a.prototype.right=function(){return b(this.points(),"max","x")},a.prototype.bounds=function(){return{top:this.top(),left:this.left(),right:this.right(),bottom:this.bottom()}},a.prototype.boundingBox=function(){return new w.geom.Rectangle(this.left(),this.top(),this.right()-this.left(),this.bottom()-this.top())},a.prototype.stroke=function(a,b){return null==b&&(b="#ff0000"),null!=a?(a.strokeStyle=b,this.drawPath(a),a.stroke()):void 0},a.prototype.fill=function(a,b){return null==b&&(b="#ff0000"),null!=a?(a.fillStyle=b,this.drawPath(a),a.fill()):void 0},a.prototype.drawPath=function(a){var b,c,d,e,f;for(c=this.points(),d=c.shift(),a.beginPath(),a.moveTo(d.x,d.y),e=0,f=c.length;f>e;e++)b=c[e],a.lineTo(b.x,b.y);return a.closePath()},a}(),w.geom.Intersections=function(){function a(){}return a.iterators={},a.prototype.intersects=function(a){var b,c;return null==a.bounds||this.boundsCollide(a)?(c=!1,b=this.intersectionsIterator(this,a),b.call(this,this,a,function(){return c=!0}),c):!1},a.prototype.intersections=function(a){var b,c;return null==a.bounds||this.boundsCollide(a)?(c=[],b=this.intersectionsIterator(this,a),b.call(this,this,a,function(a){return c.push(a),!1}),c.length>0?c:null):null},a.prototype.boundsCollide=function(a){var b,c;return b=this.bounds(),c=a.bounds(),!(b.top>c.bottom||b.left>c.right||b.bottom<c.top||b.right<c.left)},a.prototype.intersectionsIterator=function(b,c){var d,e,f;return d=b.classname?b.classname():"",e=c.classname?c.classname():"",f=null,f=a.iterators[d+e],f||(f=a.iterators[d]),f||(f=a.iterators[e]),f||this.eachIntersections},a.prototype.eachIntersections=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;for(null==d&&(d=!1),G=a.points(),H=b.points(),E=G.length,F=H.length,D=null,B=K=0,M=E-2;M>=0?M>=K:K>=M;B=M>=0?++K:--K)for(I=G[B],z=G[B+1],t=z.x-I.x,u=z.y-I.y,s=t*t+u*u,C=L=0,N=F-2;N>=0?N>=L:L>=N;C=N>=0?++L:--L)if(J=H[C],A=H[C+1],x=A.x-J.x,y=A.y-J.y,v=x*x+y*y,f=this.perCrossing(I,{x:t,y:u},J,{x:x,y:y}),h=f.x-z.x,i=f.y-z.y,k=f.x-I.x,l=f.y-I.y,n=f.x-A.x,o=f.y-A.y,q=f.x-J.x,r=f.y-J.y,g=h*h+i*i,j=k*k+l*l,m=n*n+o*o,p=q*q+r*r,s>=g&&s>=j&&v>=m&&v>=p){if(f.equals(D)){D=f;continue}if(d&&(e={segment1:new w.geom.Point(t,u),segmentIndex1:B,segmentStart1:I,segmentEnd1:z,segment2:new w.geom.Point(x,y),segmentIndex2:C,segmentStart2:J,segmentEnd2:A}),c.call(this,f,e))return;D=f}},a.prototype.perCrossing=function(a,b,c,d){var e,f,g,h,i,j,k;return j=c.x-a.x,k=c.y-a.y,g=j*d.y-k*d.x,h=b.x*d.y-b.y*d.x,i=g/h,e=a.x+b.x*i,f=a.y+b.y*i,new w.geom.Point(e,f)},a}(),w.geom.Path=function(){function a(){}return a.prototype.length=function(){var a,b,c,d,e;if(c=0,b=this.points(),b.length>1)for(a=d=1,e=b.length;e>=1?e>=d:d>=e;a=e>=1?++d:--d)c+=b[a-1].distance(b[a]);return c},a.prototype.pathPointAt=function(a,b){var c;return null==b&&(b=!0),0>a&&(a=0),a>1&&(a=1),c=this.points(),0===a?c[0]:1===a?c[c.length-1]:b?this.walkPathBasedOnLength(a,c):this.walkPathBasedOnSegments(a,c)},a.prototype.pathOrientationAt=function(a,b){var c,d,e;return null==b&&(b=!0),d=this.pathPointAt(a-.01,b),e=this.pathPointAt(a+.01,b),c=e.subtract(d),c.angle()},a.prototype.pathTangentAt=function(a,b,c){var d;return null==b&&(b=.01),null==c&&(c=!0),"boolean"==typeof b&&(d=[b,.01],c=d[0],b=d[1]),this.pathPointAt((a+b)%1,c).subtract(this.pathPointAt((1+a-b)%1),c).normalize(1)},a.prototype.walkPathBasedOnLength=function(a,b){var c,d,e,f,g,h,i,j,k;for(i=0,e=this.length(),c=j=1,k=b.length-1;k>=1?k>=j:j>=k;c=k>=1?++j:--j){if(f=b[c-1],g=b[c],h=f.distance(g)/e,i+h>a)return d=Math.map(a,i,i+h,0,1),this.pointInSegment(d,[f,g]);i+=h}},a.prototype.walkPathBasedOnSegments=function(a,b){var c,d;return d=b.length-1,a*=d,c=Math.floor(a),c===d&&(c-=1),this.pointInSegment(a-c,b.slice(c,+(c+1)+1||9e9))},a.prototype.pointInSegment=function(a,b){return b[0].add(b[1].subtract(b[0]).scale(a))},a}(),w.geom.Proxyable=function(){function a(){}return a.included=function(a){return a.proxy=function(){var b,c,d,e,f,g,h,i;for(d=2<=arguments.length?X.call(arguments,0,f=arguments.length-1):(f=0,[]),c=arguments[f++],null==c&&(c={}),e=c.as,i=[],g=0,h=d.length;h>g;g++)b=d[g],i.push(a.prototype[b].proxyable=e);return i}},a}(),w.geom.Spline=function(a){var b;return b=function(){function b(){}return b.include(E.Memoizable),b.included=function(b){return b.prototype.clone=function(){return new b(this.vertices.map(function(a){return a.clone()}),this.bias)},b.segmentSize=function(){return a}},b.prototype.initSpline=function(a,b){if(this.vertices=a,this.bias=null!=b?b:20,!this.validateVertices(this.vertices))throw new Error("The number of vertices for "+this+" doesn't match")},b.prototype.center=function(){var a,b,c,d,e,f;for(b=c=0,f=this.vertices,d=0,e=f.length;e>d;d++)a=f[d],b+=a.x,c+=a.y;return b/=this.vertices.length,c/=this.vertices.length,new o(b,c)},b.prototype.translate=function(a,b){var c,d,e,f,g,h;for(g=o.pointFrom(a,b),a=g.x,b=g.y,h=this.vertices,c=e=0,f=h.length;f>e;c=++e)d=h[c],this.vertices[c]=d.add(a,b);return this},b.prototype.rotate=function(a){var b,c,d,e,f,g;for(b=this.center(),g=this.vertices,c=e=0,f=g.length;f>e;c=++e)d=g[c],this.vertices[c]=d.rotateAround(b,a);
return this},b.prototype.scale=function(a){var b,c,d,e,f,g;for(b=this.center(),g=this.vertices,c=e=0,f=g.length;f>e;c=++e)d=g[c],this.vertices[c]=b.add(d.subtract(b).scale(a));return this},b.prototype.points=function(){var a,b,c;return this.memoized("points")?this.memoFor("points").concat():(c=this.segments()*this.bias,b=function(){var b,d;for(d=[],a=b=0;c>=0?c>=b:b>=c;a=c>=0?++b:--b)d.push(this.pathPointAt(a/c));return d}.call(this),this.memoize("points",b).concat())},b.prototype.validateVertices=function(b){return b.length%a===1&&b.length>=a+1},b.prototype.segments=function(){return null==this.vertices||0===this.vertices.length?0:this.memoized("segments")?this.memoFor("segments"):this.memoize("segments",(this.vertices.length-1)/a)},b.prototype.segmentSize=function(){return a},b.prototype.segment=function(b){var c;return b<this.segments()?(c="segment"+b,this.memoized(c)?this.memoFor(c):this.memoize(c,this.vertices).concat().slice(b*a,(b+1)*a+1)):null},b.prototype.length=function(){return this.measure(this.bias)},b.prototype.measure=function(a){var b,c,d,e;if(this.memoized("measure"))return this.memoFor("measure");for(c=0,b=d=0,e=this.segments()-1;e>=0?e>=d:d>=e;b=e>=0?++d:--d)c+=this.measureSegment(this.segment(b),a);return this.memoize("measure",c)},b.prototype.measureSegment=function(a,b){var c,d,e,f,g;if(d="segment"+a+"_"+b+"Length",this.memoized(d))return this.memoFor(d);for(f=1/b,e=0,c=g=1;b>=1?b>=g:g>=b;c=b>=1?++g:--g)e+=this.pointInSegment((c-1)*f,a).distance(this.pointInSegment(c*f,a));return this.memoize(d,e)},b.prototype.pathPointAt=function(a,b){return null==b&&(b=!0),0>a&&(a=0),a>1&&(a=1),0===a?this.vertices[0]:1===a?this.vertices[this.vertices.length-1]:b?this.walkPathBasedOnLength(a):this.walkPathBasedOnSegments(a)},b.prototype.walkPathBasedOnLength=function(a){var b,c,d,e,f,g,h,i,j;for(h=0,d=this.length(),f=this.segments(),b=i=0,j=f-1;j>=0?j>=i:i>=j;b=j>=0?++i:--i){if(e=this.segment(b),g=this.measureSegment(e,this.bias)/d,h+g>a)return c=Math.map(a,h,h+g,0,1),this.pointInSegment(c,e);h+=g}},b.prototype.walkPathBasedOnSegments=function(a){var b,c;return c=this.segments(),a*=c,b=Math.floor(a),b===c&&(b-=1),this.pointInSegment(a-b,this.segment(b))},b.prototype.fill=function(){},b.prototype.drawPath=function(a){var b,c,d,e,f,g;for(c=this.points(),d=c.shift(),a.beginPath(),a.moveTo(d.x,d.y),g=[],e=0,f=c.length;f>e;e++)b=c[e],g.push(a.lineTo(b.x,b.y));return g},b.prototype.drawVertices=function(a,b){var c,d,e,f,g;for(a.fillStyle=b,f=this.vertices,g=[],d=0,e=f.length;e>d;d++)c=f[d],a.beginPath(),a.arc(c.x,c.y,2,0,2*Math.PI),a.fill(),g.push(a.closePath());return g},b.prototype.drawVerticesConnections=function(a,b){var c,d,e,f,g,h;for(a.strokeStyle=b,h=[],c=f=1,g=this.vertices.length-1;g>=1?g>=f:f>=g;c=g>=1?++f:--f)e=this.vertices[c-1],d=this.vertices[c],a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(d.x,d.y),a.stroke(),h.push(a.closePath());return h},b.prototype.memoizationKey=function(){return this.vertices.map(function(a){return""+a.x+";"+a.y}).join(";")},b}()},w.geom.Surface=function(){function a(){}return a.prototype.acreage=function(){return null},a.prototype.randomPointInSurface=function(){return null},a.prototype.contains=function(){return null},a.prototype.containsGeometry=function(a){return a.points().every(function(a){return function(b){return a.contains(b)}}(this))},a}(),w.geom.Triangulable=function(){function a(){}var b,c,d,e;return a.include(E.Memoizable),a.prototype.triangles=function(){var a,b,c,d,f,g,h,i,j,k;if(this.memoized("triangles"))return this.memoFor("triangles");for(i=this.points(),i.pop(),g=e(i),h=[],d=j=0,k=g.length/3-1;k>=0?k>=j:j>=k;d=k>=0?++j:--j)f=3*d,a=i[g[f]],b=i[g[f+1]],c=i[g[f+2]],h.push(new w.geom.Triangle(a,b,c));return this.memoize("triangles",h)},b=function(a,b){var c,d,e,f,g;for(g=[],c=e=0,f=b.length;f>e;c=++e)d=b[c],g.push(a[c]=d);return g},c=function(a,b,c,d){var e,f,g,h;return h=(b.y-d.y)*(c.x-d.x)+(c.y-d.y)*(d.x-b.x),e=((a.y-d.y)*(c.x-d.x)+(c.y-d.y)*(d.x-a.x))/h,f=((a.y-b.y)*(d.x-b.x)+(d.y-b.y)*(b.x-a.x))/h,g=((a.y-c.y)*(b.x-c.x)+(b.y-c.y)*(c.x-a.x))/h,0>e||0>f||0>g?!1:!0},d=function(a){var b,c,d,e,f;for(d=0,b=0,c=a.length,b=e=0,f=c-1;f>=0?f>=e:e>=f;b=f>=0?++e:--e)d+=a[b].x*a[(b+1)%c].y-a[(b+1)%c].x*a[b].y;return d/2},e=function(a){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(!(a.length<4)){for(t=0,i=100,n=a,s=function(){var a,b,c;for(c=[],f=a=0,b=n.length;b>a;f=++a)j=n[f],c.push(f);return c}(),o=[],f=0,h=s.length;h>f;)o[f]=n[s[f]].clone(),++f;for(m=d(o),e=[],k=[],b(e,s);e.length>3;)for(f=0,h=e.length;h>f;){for(p=e[f%h],q=e[(f+1)%h],r=e[(f+2)%h],w=n[p],x=n[q],y=n[r],l=!0,g=(f+3)%h;g!==f;){if(o=[w,x,y],u=d(o),0>m&&u>0||m>0&&0>u||c(n[e[g]],w,x,y)){l=!1;break}if(g=(g+1)%h,t+=1,t>i)break}if(l){k.push(p,q,r),e.splice((f+1)%h,1);break}++f}return k.push.apply(k,e.slice(0,3)),v=!0,k}},a}(),w.geom.Point=function(){function a(a,b){null!=a&&(b=a.y||b),isNaN(b)&&(b=0),null!=a&&(a=a.x||a),isNaN(a)&&(a=0),this.x=a,this.y=b}return a.include(E.Equatable("x","y")),a.include(E.Formattable("Point","x","y")),a.include(E.Sourcable("agt.geom.Point","x","y")),a.include(E.Cloneable()),a.isPoint=function(a){return null!=a&&null!=a.x&&null!=a.y},a.pointFrom=function(b,c,d){var e;return null==d&&(d=!1),e=b,null!=b&&"object"==typeof b&&(e=b.x,c=b.y),d&&(isNaN(e)||isNaN(c))&&this.notAPoint([e,c]),new a(e,c)},a.polar=function(b,c){return null==c&&(c=1),new a(Math.sin(b)*c,Math.cos(b)*c)},a.interpolate=function(b,c,d){var e,f,g,h,i,j,k;for(e=[],h=j=0,k=arguments.length;k>j;h=++j)i=arguments[h],e[h]=i;return g=function(b){return function(c,d){var e;return e=null,b.isPoint(c[0])?e=c.shift():Math.isFloat(c[0])&&Math.isFloat(c[1])?(e=new a(c[0],c[1]),c.splice(0,2)):b.missingPoint(c,d),e}}(this),b=g(e,"first"),c=g(e,"second"),d=parseFloat(e.shift()),isNaN(d)&&this.missingPosition(d),f=c.subtract(b),new a(b.x+f.x*d,b.y+f.y*d)},a.missingPosition=function(a){throw new Error("Point.interpolate require a position but "+a+" was given")},a.missingPoint=function(a,b){var c;throw c="Can't find the "+b+" point in Point.interpolate arguments "+a,new Error(c)},a.notAPoint=function(a){throw new Error(""+a+" is not a point")},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.angle=function(){return Math.atan2(this.y,this.x)},a.prototype.angleWith=function(b,c){var d,e;return null==b&&null==c&&this.noPoint("dot"),e=this.isPoint(b),c=e?b.y:c,b=e?b.x:b,(isNaN(b)||isNaN(c))&&a.notAPoint([b,c]),d=this.normalize().dot(new a(b,c).normalize()),Math.acos(Math.abs(d))*(0>d?-1:1)},a.prototype.normalize=function(b){var c;return null==b&&(b=1),Math.isFloat(b)||this.invalidLength(b),c=this.length(),new a(this.x/c*b,this.y/c*b)},a.prototype.add=function(b,c){return null!=b&&(c=b.y||c),isNaN(c)&&(c=0),null!=b&&(b=b.x||b),isNaN(b)&&(b=0),new a(this.x+b,this.y+c)},a.prototype.subtract=function(b,c){return null!=b&&(c=b.y||c),isNaN(c)&&(c=0),null!=b&&(b=b.x||b),isNaN(b)&&(b=0),new a(this.x-b,this.y-c)},a.prototype.dot=function(b,c){var d;return null==b&&null==c&&this.noPoint("dot"),d=this.isPoint(b),c=d?b.y:c,b=d?b.x:b,(isNaN(b)||isNaN(c))&&a.notAPoint([b,c]),this.x*b+this.y*c},a.prototype.distance=function(b,c){var d;return null==b&&null==c&&this.noPoint("distance"),d=this.isPoint(b),c=d?b.y:c,b=d?b.x:b,(isNaN(b)||isNaN(c))&&a.notAPoint([b,c]),this.subtract(b,c).length()},a.prototype.scale=function(b){return Math.isFloat(b)||this.invalidScale(b),new a(this.x*b,this.y*b)},a.prototype.rotate=function(b){var c,d,e,f;return Math.isFloat(b)||this.invalidRotation(b),d=this.length(),c=Math.atan2(this.y,this.x)+b,e=Math.cos(c)*d,f=Math.sin(c)*d,new a(e,f)},a.prototype.rotateAround=function(a,b,c){var d;return d=this.isPoint(a),d&&(c=b),b=d?a.y:b,a=d?a.x:a,this.subtract(a,b).rotate(c).add(a,b)},a.prototype.isPoint=a.isPoint,a.prototype.pointFrom=a.pointFrom,a.prototype.defaultToZero=function(a,b){return a=isNaN(a)?0:a,b=isNaN(b)?0:b,[a,b]},a.prototype.paste=function(a,b){var c;return null==a&&null==b?this:(c=null!=a&&"object"==typeof a,b=c?a.y:b,a=c?a.x:a,isNaN(a)||(this.x=a),isNaN(b)||(this.y=b),this)},a.prototype.noPoint=function(a){throw new Error(""+a+" was called without arguments")},a.prototype.invalidLength=function(a){throw new Error("Invalid length "+a+" provided")},a.prototype.invalidScale=function(a){throw new Error("Invalid scale "+a+" provided")},a.prototype.invalidRotation=function(a){throw new Error("Invalid rotation "+a+" provided")},a}(),K=w.geom,o=K.Point,n=K.Path,t=K.Surface,d=K.Geometry,f=K.Intersections,w.geom.Triangle=function(){function a(a,b,c){var d;d=this.triangleFrom(a,b,c),this.a=d.a,this.b=d.b,this.c=d.c,this.__cache__={}}return a.include(E.Equatable("a","b","c")),a.include(E.Formattable("Triangle","a","b","c")),a.include(E.Sourcable("agt.geom.Triangle","a","b","c")),a.include(E.Cloneable()),a.include(E.Memoizable),a.include(d),a.include(t),a.include(n),a.include(f),a.triangleFrom=function(a,b,c){var d;return null==a||"object"!=typeof a||o.isPoint(a)||(d=a,a=d.a,b=d.b,c=d.c),o.isPoint(a)||this.invalidPoint("a",a),o.isPoint(b)||this.invalidPoint("b",b),o.isPoint(c)||this.invalidPoint("c",c),{a:new o(a),b:new o(b),c:new o(c)}},a.prototype.center=function(){return new o((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)},a.prototype.abCenter=function(){},a.prototype.acCenter=function(){},a.prototype.adCenter=function(){},["abCenter","acCenter","bcCenter"].forEach(function(b){var c,d,e;return e=b.split(""),c=e[0],d=e[1],a.prototype[b]=function(){return this[c].add(this[""+c+d]().scale(.5))}}),a.prototype.edges=function(){return[this.ab(),this.bc(),this.ca()]},a.prototype.ab=function(){},a.prototype.ac=function(){},a.prototype.ba=function(){},a.prototype.bc=function(){},a.prototype.ca=function(){},a.prototype.cb=function(){},["ab","ac","ba","bc","ca","cb"].forEach(function(b){var c,d,e;return e=b.split(""),c=e[0],d=e[1],a.prototype[b]=function(){return this[d].subtract(this[c])}}),a.prototype.abc=function(){},a.prototype.bac=function(){},a.prototype.acb=function(){},["abc","bac","acb"].forEach(function(b){var c,d,e,f;return f=b.split(""),c=f[0],d=f[1],e=f[2],a.prototype[b]=function(){return this[""+d+c]().angleWith(this[""+d+e]())}}),a.prototype.top=function(){return Math.min(this.a.y,this.b.y,this.c.y)},a.prototype.bottom=function(){return Math.max(this.a.y,this.b.y,this.c.y)},a.prototype.left=function(){return Math.min(this.a.x,this.b.x,this.c.x)},a.prototype.right=function(){return Math.max(this.a.x,this.b.x,this.c.x)},a.prototype.equilateral=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())&&Math.deltaBelowRatio(this.ab().length(),this.ac().length())},a.prototype.isosceles=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())||Math.deltaBelowRatio(this.ab().length(),this.ac().length())||Math.deltaBelowRatio(this.bc().length(),this.ac().length())},a.prototype.rectangle=function(){var a;return a=Math.PI/2,Math.deltaBelowRatio(Math.abs(this.abc()),a)||Math.deltaBelowRatio(Math.abs(this.bac()),a)||Math.deltaBelowRatio(Math.abs(this.acb()),a)},a.prototype.translate=function(a,b){var c;return c=o.pointFrom(a,b),this.a.x+=c.x,this.a.y+=c.y,this.b.x+=c.x,this.b.y+=c.y,this.c.x+=c.x,this.c.y+=c.y,this},a.prototype.rotate=function(a){var b;return b=this.center(),this.a=this.a.rotateAround(b,a),this.b=this.b.rotateAround(b,a),this.c=this.c.rotateAround(b,a),this},a.prototype.scale=function(a){var b;return b=this.center(),this.a=b.add(this.a.subtract(b).scale(a)),this.b=b.add(this.b.subtract(b).scale(a)),this.c=b.add(this.c.subtract(b).scale(a)),this},a.prototype.rotateAroundCenter=a.prototype.rotate,a.prototype.scaleAroundCenter=a.prototype.scale,a.prototype.closedGeometry=function(){return!0},a.prototype.points=function(){return[this.a.clone(),this.b.clone(),this.c.clone(),this.a.clone()]},a.prototype.pointAtAngle=function(a){var b,c,d;return b=this.center(),c=b.add(1e4*Math.cos(a),1e4*Math.sin(a)),null!=(d=this.intersections({points:function(){return[b,c]}}))?d[0]:void 0},a.prototype.acreage=function(){return this.memoized("acreage")?this.memoFor("acreage"):this.memoize("acreage",this.ab().length()*this.bc().length()*Math.abs(Math.sin(this.abc()))/2)},a.prototype.contains=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;return i=new o(a,b),l=this.ac(),m=this.ab(),n=i.subtract(this.a),c=l.dot(l),d=l.dot(m),e=l.dot(n),f=m.dot(m),g=m.dot(n),h=1/(c*f-d*d),j=(f*e-d*g)*h,k=(c*g-d*e)*h,j>0&&k>0&&1>j+k},a.prototype.randomPointInSurface=function(a){var b,c,d;return null==a&&(a=new chancejs.Random(new chancejs.MathRandom)),b=a.get(),c=a.get(),d=this.a.add(this.ab().scale(b)).add(this.ca().scale(-1*c)),this.contains(d)?d:d.add(this.bcCenter().subtract(d).scale(2))},a.prototype.length=function(){return this.ab().length()+this.bc().length()+this.ca().length()},a.prototype.pathPointAt=function(a,b){var c,d,e;return null==b&&(b=!0),e=this.pathSteps(b),c=e[0],d=e[1],c>a?this.a.add(this.ab().scale(Math.map(a,0,c,0,1))):d>a?this.b.add(this.bc().scale(Math.map(a,c,d,0,1))):this.c.add(this.ca().scale(Math.map(a,d,1,0,1)))},a.prototype.pathOrientationAt=function(a,b){var c,d,e;return null==b&&(b=!0),e=this.pathSteps(b),c=e[0],d=e[1],c>a?this.ab().angle():d>a?this.bc().angle():this.ca().angle()},a.prototype.pathSteps=function(a){var b,c,d;return a?(b=this.length(),c=this.ab().length()/b,d=c+this.bc().length()/b):(c=1/3,d=2/3),[c,d]},a.prototype.drawPath=function(a){return a.beginPath(),a.moveTo(this.a.x,this.a.y),a.lineTo(this.b.x,this.b.y),a.lineTo(this.c.x,this.c.y),a.lineTo(this.a.x,this.a.y),a.closePath()},a.prototype.memoizationKey=function(){return""+this.a.x+";"+this.a.y+";"+this.b.x+";"+this.b.y+";"+this.c.x+";"+this.c.y},a.prototype.triangleFrom=a.triangleFrom,a.prototype.invalidPoint=function(a,b){throw new Error("Invalid point "+b+" for vertex "+a)},a}(),L=w.geom,o=L.Point,v=L.Triangulable,p=L.Proxyable,d=L.Geometry,t=L.Surface,n=L.Path,f=L.Intersections,w.geom.Rectangle=function(){function a(){var a;a=this.defaultToZero(this.rectangleFrom.apply(this,arguments)),this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.rotation=a.rotation}var b,c,e;return e=["x","y","width","height","rotation"],a.extend(E.Aliasable),a.include(E.Equatable.apply(null,e)),a.include(E.Formattable.apply(null,["Rectangle"].concat(e))),a.include(E.Sourcable.apply(null,["agt.geom.Rectangle"].concat(e))),a.include(E.Parameterizable("rectangleFrom",{x:0/0,y:0/0,width:0/0,height:0/0,rotation:0/0})),a.include(E.Cloneable()),a.include(d),a.include(t),a.include(n),a.include(v),a.include(p),a.include(f),a.eachRectangleRectangleIntersections=function(a,b,c,d){var e,f,g,h;if(null==d&&(d=!1),!a.equals(b))return this.eachIntersections(a,b,c,d);for(h=a.points(),f=0,g=h.length;g>f;f++)if(e=h[f],c.call(this,e))return},b=f.iterators,c="RectangleRectangle",b[c]=a.eachRectangleRectangleIntersections,a.prototype.corners=function(){return[this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft()]},a.prototype.topLeft=function(){return new o(this.x,this.y)},a.prototype.topRight=function(){return this.topLeft().add(this.topEdge())},a.prototype.bottomLeft=function(){return this.topLeft().add(this.leftEdge())},a.prototype.bottomRight=function(){return this.topLeft().add(this.topEdge()).add(this.leftEdge())},a.prototype.center=function(){return this.topLeft().add(this.diagonal().scale(.5))},a.prototype.topEdgeCenter=function(){return this.topLeft().add(this.topEdge().scale(.5))},a.prototype.bottomEdgeCenter=function(){return this.bottomLeft().add(this.topEdge().scale(.5))},a.prototype.leftEdgeCenter=function(){return this.topLeft().add(this.leftEdge().scale(.5))},a.prototype.rightEdgeCenter=function(){return this.topRight().add(this.leftEdge().scale(.5))},a.prototype.edges=function(){return[this.topEdge(),this.topRight(),this.bottomRight(),this.bottomLeft()]},a.prototype.topEdge=function(){return new o(this.width*Math.cos(this.rotation),this.width*Math.sin(this.rotation))},a.prototype.leftEdge=function(){return new o(this.height*Math.cos(this.rotation+Math.PI/2),this.height*Math.sin(this.rotation+Math.PI/2))},a.prototype.bottomEdge=function(){return this.topEdge()},a.prototype.rightEdge=function(){return this.leftEdge()},a.prototype.diagonal=function(){return this.leftEdge().add(this.topEdge())},a.prototype.top=function(){return Math.min(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},a.prototype.bottom=function(){return Math.max(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},a.prototype.left=function(){return Math.min(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},a.prototype.right=function(){return Math.max(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},a.prototype.setCenter=function(a,b){var c;return c=o.pointFrom(a,b).subtract(this.center()),this.x+=c.x,this.y+=c.y,this},a.prototype.translate=function(a,b){var c;return c=o.pointFrom(a,b),this.x+=c.x,this.y+=c.y,this},a.prototype.rotate=function(a){var b;return b=this.topLeft().rotateAround(this.center(),a),this.x=b.x,this.y=b.y,this.rotation+=a,this},a.alias("rotate","rotateAroundCenter"),a.prototype.scale=function(a){var b;return b=this.center(),this.width*=a,this.height*=a,this.setCenter(b),this},a.alias("scale","scaleAroundCenter"),a.prototype.inflateAroundCenter=function(a,b){var c;return c=this.center(),this.inflate(a,b),this.setCenter(c),this},a.prototype.inflate=function(a,b){var c;return c=o.pointFrom(a,b),this.width+=c.x,this.height+=c.y,this},a.prototype.inflateLeft=function(a){var b,c;return this.width+=a,b=this.topEdge().normalize(-a),c=this.topLeft().add(b),this.x=c.x,this.y=c.y,this},a.prototype.inflateRight=function(a){return this.width+=a,this},a.prototype.inflateTop=function(a){var b,c;return this.height+=a,b=this.leftEdge().normalize(-a),c=this.topLeft().add(b),this.x=c.x,this.y=c.y,this},a.prototype.inflateBottom=function(a){return this.height+=a,this},a.prototype.inflateTopLeft=function(a,b){var c;return c=o.pointFrom(a,b),this.inflateLeft(c.x),this.inflateTop(c.y),this},a.prototype.inflateTopRight=function(a,b){var c;return c=o.pointFrom(a,b),this.inflateRight(c.x),this.inflateTop(c.y),this},a.prototype.inflateBottomLeft=function(a,b){var c;return c=o.pointFrom(a,b),this.inflateLeft(c.x),this.inflateBottom(c.y),this},a.prototype.inflateBottomRight=function(a,b){return this.inflate(a,b)},a.prototype.closedGeometry=function(){return!0},a.prototype.points=function(){return[this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft(),this.topLeft()]},a.prototype.pointAtAngle=function(a){var b,c,d;return b=this.center(),c=b.add(1e4*Math.cos(a),1e4*Math.sin(a)),null!=(d=this.intersections({points:function(){return[b,c]}}))?d[0]:void 0},a.prototype.acreage=function(){return this.width*this.height},a.prototype.contains=function(a,b){var c,d;return d=new o(a,b).rotateAround(this.topLeft(),-this.rotation),c=d.x,b=d.y,this.x<=c&&c<=this.x+this.width&&this.y<=b&&b<=this.y+this.height},a.prototype.randomPointInSurface=function(a){return null==a&&(a=new chancejs.Random(new chancejs.MathRandom)),this.topLeft().add(this.topEdge().scale(a.get())).add(this.leftEdge().scale(a.get()))},a.prototype.length=function(){return 2*this.width+2*this.height},a.prototype.pathPointAt=function(a,b){var c,d,e,f;return null==b&&(b=!0),f=this.pathSteps(b),c=f[0],d=f[1],e=f[2],c>a?this.topLeft().add(this.topEdge().scale(Math.map(a,0,c,0,1))):d>a?this.topRight().add(this.rightEdge().scale(Math.map(a,c,d,0,1))):e>a?this.bottomRight().add(this.bottomEdge().scale(-1*Math.map(a,d,e,0,1))):this.bottomLeft().add(this.leftEdge().scale(-1*Math.map(a,e,1,0,1)))},a.prototype.pathOrientationAt=function(a,b){var c,d,e,f,g;return null==b&&(b=!0),g=this.pathSteps(b),d=g[0],e=g[1],f=g[2],c=d>a?this.topEdge():e>a?this.rightEdge():f>a?this.bottomEdge().scale(-1):this.leftEdge().scale(-1),c.angle()},a.prototype.pathSteps=function(a){var b,c,d,e;return null==a&&(a=!0),a?(b=this.length(),c=this.width/b,d=(this.width+this.height)/b,e=c+d):(c=.25,d=.5,e=.75),[c,d,e]},a.prototype.drawPath=function(a){return a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(this.topRight().x,this.topRight().y),a.lineTo(this.bottomRight().x,this.bottomRight().y),a.lineTo(this.bottomLeft().x,this.bottomLeft().y),a.lineTo(this.x,this.y),a.closePath()},a.prototype.paste=function(a,b,d,e,f){var g,h,i;h=this.rectangleFrom(a,b,d,e,f),i=[];for(c in h)g=h[c],Math.isFloat(g)&&i.push(this[c]=parseFloat(g));return i},a.prototype.defaultToZero=function(a){var b;for(c in a)b=a[c],Math.isFloat(b)||(a[c]=0);return a},a.proxy("pathOrientationAt",{as:"Angle"}),a.proxy("points","corners","edges",{as:"PointList"}),a.proxy("topLeft","topRight","bottomLeft","bottomRight","center","topEdgeCenter","bottomEdgeCenter","leftEdgeCenter","rightEdgeCenter","topEdge","leftEdge","rightEdge","bottomEdge","diagonal","pathPointAt",{as:"Point"}),a}(),O=w.geom,o=O.Point,u=O.Triangle,d=O.Geometry,t=O.Surface,n=O.Path,f=O.Intersections,w.geom.Circle=function(){function a(a,b,c,d){var e;e=this.circleFrom(a,b,c,d),this.radius=e.radius,this.x=e.x,this.y=e.y,this.segments=e.segments}var b;return a.include(E.Equatable("x","y","radius")),a.include(E.Formattable("Circle","x","y","radius")),a.include(E.Parameterizable("circleFrom",{radius:1,x:0,y:0,segments:36})),a.include(E.Sourcable("agt.geom.Circle","radius","x","y")),a.include(E.Cloneable()),a.include(E.Memoizable),a.include(d),a.include(t),a.include(n),a.include(f),a.eachIntersections=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;for(null==d&&(d=!1),"Circle"===("function"==typeof b.classname?b.classname():void 0)&&(l=[b,a],a=l[0],b=l[1]),i=b.points(),g=i.length,h=[],f=k=0,m=g-2;m>=0?m>=k:k>=m;f=m>=0?++k:--k)if(j=i[f],e=i[f+1],a.eachLineIntersections(j,e,c))return},a.eachCircleCircleIntersections=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,p,q,r,s;if(null==d&&(d=!1),!a.equals(b)){if(m=a.radius,n=b.radius,k=a.center(),l=b.center(),f=k.distance(l),g=l.subtract(k),p=m+n,f>p)return;return f===p?c.call(this,k.add(g.normalize(m))):(e=(m*m-n*n+f*f)/(2*f),h=Math.sqrt(m*m-e*e),i=new o(h*(l.y-k.y)/f,-h*(l.x-k.x)/f),j=k.add(g.normalize(e)).add(i),c.call(this,j),j=k.add(g.normalize(e)).add(i.scale(-1)),c.call(this,j))}for(s=a.points(),q=0,r=s.length;r>q;q++)if(j=s[q],c.call(this,j))return},b=f.iterators,b.Circle=a.eachIntersections,b.CircleCircle=a.eachCircleCircleIntersections,a.prototype.center=function(){return new o(this.x,this.y)},a.prototype.top=function(){return this.y-this.radius},a.prototype.bottom=function(){return this.y+this.radius},a.prototype.left=function(){return this.x-this.radius},a.prototype.right=function(){return this.x+this.radius},a.prototype.translate=function(a,b){var c,d;return d=o.pointFrom(a,b),c=d.x,b=d.y,this.x+=c,this.y+=b,this},a.prototype.rotate=function(){return this},a.prototype.scale=function(a){return this.radius*=a,this},a.prototype.points=function(){var a,b,c,d,e;for(b=2*Math.PI/this.segments,e=[],a=c=0,d=this.segments;d>=0?d>=c:c>=d;a=d>=0?++c:--c)e.push(this.pointAtAngle(a*b));return e},a.prototype.triangles=function(){var a,b,c,d,e,f;if(this.memoized("triangles"))return this.memoFor("triangles");for(d=[],c=this.points(),a=this.center(),b=e=1,f=c.length-1;f>=1?f>=e:e>=f;b=f>=1?++e:--e)d.push(new u(a,c[b-1],c[b]));return this.memoize("triangles",d)},a.prototype.closedGeometry=function(){return!0},a.prototype.eachLineIntersections=function(a,b,c){var d,e,f,g,h,i,j,k;if(d=this.center(),j=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y),k=2*((b.x-a.x)*(a.x-d.x)+(b.y-a.y)*(a.y-d.y)),e=d.x*d.x+d.y*d.y+a.x*a.x+a.y*a.y-2*(d.x*a.x+d.y*a.y)-this.radius*this.radius,f=k*k-4*j*e,f>0&&(g=Math.sqrt(f),h=(-k+g)/(2*j),i=(-k-g)/(2*j),!(0>h||h>1)||!(0>i||i>1))){if(i>=0&&1>=i&&c.call(this,o.interpolate(a,b,i)))return;h>=0&&1>=h&&c.call(this,o.interpolate(a,b,h))}},a.prototype.pointAtAngle=function(a){return new o(this.x+Math.cos(a)*this.radius,this.y+Math.sin(a)*this.radius)},a.prototype.acreage=function(){return this.radius*this.radius*Math.PI},a.prototype.contains=function(a,b){var c;return c=o.pointFrom(a,b,!0),this.center().subtract(c).length()<=this.radius},a.prototype.randomPointInSurface=function(a){var b,c,d;return null==a&&(a=new a.Random(new a.MathRandom)),d=this.pointAtAngle(a.random(2*Math.PI)),b=this.center(),c=d.subtract(b),b.add(c.scale(Math.sqrt(a.random())))},a.prototype.length=function(){return this.radius*Math.PI*2},a.prototype.pathPointAt=function(a){return this.pointAtAngle(a*Math.PI*2)},a.prototype.drawPath=function(a){return a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI)},a.prototype.memoizationKey=function(){return""+this.radius+";"+this.x+";"+this.y+";"+this.segments},a}(),P=w.geom,o=P.Point,f=P.Intersections,d=P.Geometry,s=P.Spline,n=P.Path,w.geom.CubicBezier=function(){function a(a,b){null==b&&(b=20),this.initSpline(a,b)}return a.include(E.Formattable("CubicBezier")),a.include(E.Sourcable("agt.geom.CubicBezier","vertices","bias")),a.include(d),a.include(n),a.include(f),a.include(s(3)),a.prototype.pointInSegment=function(a,b){var c;return c=new o,c.x=b[0].x*this.b1(a)+b[1].x*this.b2(a)+b[2].x*this.b3(a)+b[3].x*this.b4(a),c.y=b[0].y*this.b1(a)+b[1].y*this.b2(a)+b[2].y*this.b3(a)+b[3].y*this.b4(a),c},a.prototype.b1=function(a){return(1-a)*(1-a)*(1-a)},a.prototype.b2=function(a){return 3*a*(1-a)*(1-a)},a.prototype.b3=function(a){return 3*a*a*(1-a)},a.prototype.b4=function(a){return a*a*a},a}(),Q=w.geom,d=Q.Geometry,t=Q.Surface,n=Q.Path,f=Q.Intersections,w.geom.Diamond=function(){function a(a,b,c,d,e,f,g){var h;h=this.diamondFrom(a,b,c,d,e,f,g),this.topLength=h.topLength,this.rightLength=h.rightLength,this.bottomLength=h.bottomLength,this.leftLength=h.leftLength,this.x=h.x,this.y=h.y,this.rotation=h.rotation}var b;return b=["topLength","rightLength","bottomLength","leftLength","x","y","rotation"],a.include(E.Formattable.apply(E,["Diamond"].concat(b))),a.include(E.Parameterizable("diamondFrom",{topLength:1,rightLength:1,bottomLength:1,leftLength:1,x:0,y:0,rotation:0})),a.include(E.Sourcable(["agt.geom.Diamond"].concat(b))),a.include(E.Equatable.apply(E,b)),a.include(E.Cloneable()),a.include(E.Memoizable),a.include(d),a.include(t),a.include(n),a.include(f),a.prototype.center=function(){return new C.Point(this.x,this.y)},a.prototype.topAxis=function(){return new C.Point(0,-this.topLength).rotate(this.rotation)},a.prototype.bottomAxis=function(){return new C.Point(0,this.bottomLength).rotate(this.rotation)},a.prototype.leftAxis=function(){return new C.Point(-this.leftLength,0).rotate(this.rotation)},a.prototype.rightAxis=function(){return new C.Point(this.rightLength,0).rotate(this.rotation)},a.prototype.corners=function(){return[this.topCorner(),this.rightCorner(),this.bottomCorner(),this.leftCorner()]},a.prototype.topCorner=function(){return this.center().add(this.topAxis())},a.prototype.bottomCorner=function(){return this.center().add(this.bottomAxis())},a.prototype.leftCorner=function(){return this.center().add(this.leftAxis())},a.prototype.rightCorner=function(){return this.center().add(this.rightAxis())},a.prototype.edges=function(){return[this.topLeftEdge(),this.topRightEdge(),this.bottomRightEdge(),this.bottomLeftEdge()]},a.prototype.topLeftEdge=function(){return this.topCorner().subtract(this.leftCorner())},a.prototype.topRightEdge=function(){return this.rightCorner().subtract(this.topCorner())},a.prototype.bottomLeftEdge=function(){return this.leftCorner().subtract(this.bottomCorner())},a.prototype.bottomRightEdge=function(){return this.bottomCorner().subtract(this.rightCorner())},a.prototype.quadrants=function(){return[this.topLeftQuadrant(),this.topRightQuadrant(),this.bottomRightQuadrant(),this.bottomLeftQuadrant()]},a.prototype.topLeftQuadrant=function(){var a;return a="topLeftQuadrant",this.memoized(a)?this.memoFor(a):this.memoize(a,new C.Triangle(this.center(),this.topCorner(),this.leftCorner()))},a.prototype.topRightQuadrant=function(){var a;return a="topRightQuadrant",this.memoized(a)?this.memoFor(a):this.memoize(a,new C.Triangle(this.center(),this.topCorner(),this.rightCorner()))},a.prototype.bottomLeftQuadrant=function(){var a;return a="bottomLeftQuadrant",this.memoized(a)?this.memoFor(a):this.memoize(a,new C.Triangle(this.center(),this.bottomCorner(),this.leftCorner()))},a.prototype.bottomRightQuadrant=function(){var a;return a="bottomRightQuadrant",this.memoized(a)?this.memoFor(a):this.memoize(a,new C.Triangle(this.center(),this.bottomCorner(),this.rightCorner()))},a.prototype.top=function(){return Math.min(this.topCorner().y,this.bottomCorner().y,this.leftCorner().y,this.rightCorner().y)},a.prototype.bottom=function(){return Math.max(this.topCorner().y,this.bottomCorner().y,this.leftCorner().y,this.rightCorner().y)},a.prototype.left=function(){return Math.min(this.topCorner().x,this.bottomCorner().x,this.leftCorner().x,this.rightCorner().x)},a.prototype.right=function(){return Math.max(this.topCorner().x,this.bottomCorner().x,this.leftCorner().x,this.rightCorner().x)},a.prototype.translate=function(a,b){var c,d;return d=C.Point.pointFrom(a,b),c=d.x,b=d.y,this.x+=c,this.y+=b,this},a.prototype.rotate=function(a){return this.rotation+=a,this},a.prototype.scale=function(a){return this.topLength*=a,this.bottomLength*=a,this.rightLength*=a,this.leftLength*=a,this},a.prototype.points=function(){var a;return[a=this.topCorner(),this.rightCorner(),this.bottomCorner(),this.leftCorner(),a]},a.prototype.triangles=function(){return this.quadrants()},a.prototype.closedGeometry=function(){return!0},a.prototype.pointAtAngle=function(a){var b,c,d;return b=this.center(),c=b.add(1e4*Math.cos(a),1e4*Math.sin(a)),null!=(d=this.intersections({points:function(){return[b,c]}}))?d[0]:void 0},a.prototype.acreage=function(){return this.topLeftQuadrant().acreage()+this.topRightQuadrant().acreage()+this.bottomLeftQuadrant().acreage()+this.bottomRightQuadrant().acreage()},a.prototype.contains=function(a,b){return this.center().equals(a,b)||this.topLeftQuadrant().contains(a,b)||this.topRightQuadrant().contains(a,b)||this.bottomLeftQuadrant().contains(a,b)||this.bottomRightQuadrant().contains(a,b)},a.prototype.randomPointInSurface=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return g=this.acreage(),m=this.topLeftQuadrant(),n=this.topRightQuadrant(),o=this.bottomRightQuadrant(),p=this.bottomLeftQuadrant(),c=m.acreage(),d=n.acreage(),e=o.acreage(),f=p.acreage(),b=c+d+e+f,h=c/b,i=d/b,j=e/b,k=f/b,l=a.get(),h>l?m.randomPointInSurface(a):h+i>l?n.randomPointInSurface(a):h+i+j>l?o.randomPointInSurface(a):p.randomPointInSurface(a)},a.prototype.length=function(){return this.topRightEdge().length()+this.topLeftEdge().length()+this.bottomRightEdge().length()+this.bottomLeftEdge().length()},a.prototype.pathPointAt=function(a,b){var c,d,e,f;return null==b&&(b=!0),f=this.pathSteps(b),c=f[0],d=f[1],e=f[2],c>a?this.topCorner().add(this.topRightEdge().scale(Math.map(a,0,c,0,1))):d>a?this.rightCorner().add(this.bottomRightEdge().scale(Math.map(a,c,d,0,1))):e>a?this.bottomCorner().add(this.bottomLeftEdge().scale(Math.map(a,d,e,0,1))):this.leftCorner().add(this.topLeftEdge().scale(Math.map(a,e,1,0,1)))},a.prototype.pathOrientationAt=function(a,b){var c,d,e,f,g;return null==b&&(b=!0),g=this.pathSteps(b),d=g[0],e=g[1],f=g[2],c=d>a?this.topRightEdge():e>a?this.bottomRightEdge():f>a?this.bottomLeftEdge().scale(-1):this.topLeftEdge().scale(-1),c.angle()},a.prototype.pathSteps=function(a){var b,c,d,e;return null==a&&(a=!0),a?(b=this.length(),c=this.topRightEdge().length()/b,d=c+this.bottomRightEdge().length()/b,e=d+this.bottomLeftEdge().length()/b):(c=.25,d=.5,e=.75),[c,d,e]},a.prototype.memoizationKey=function(){return""+this.x+";"+this.y+";"+this.rotation+";"+this.topLength+";"+this.bottomLength+";"+this.leftLength+";"+this.rightLength+";"},a}(),R=w.geom,o=R.Point,d=R.Geometry,u=R.Triangle,t=R.Surface,n=R.Path,f=R.Intersections,w.geom.Ellipsis=function(){function a(a,b,c,d,e,f){var g;g=this.ellipsisFrom(a,b,c,d,e,f),this.radius1=g.radius1,this.radius2=g.radius2,this.x=g.x,this.y=g.y,this.rotation=g.rotation,this.segments=g.segments}var b;return b=["radius1","radius2","x","y","rotation","segments"],a.include(E.Equatable.apply(E,b)),a.include(E.Formattable.apply(E,["Ellipsis"].concat(b))),a.include(E.Parameterizable("ellipsisFrom",{radius1:1,radius2:1,x:0,y:0,rotation:0,segments:36})),a.include(E.Sourcable.apply(E,["agt.geom.Ellipsis"].concat(b))),a.include(E.Cloneable()),a.include(E.Memoizable),a.include(d),a.include(t),a.include(n),a.include(f),a.prototype.center=function(){return new o(this.x,this.y)
},a.prototype.left=function(){return Math.min.apply(Math,this.xBounds())},a.prototype.right=function(){return Math.max.apply(Math,this.xBounds())},a.prototype.bottom=function(){return Math.max.apply(Math,this.yBounds())},a.prototype.top=function(){return Math.min.apply(Math,this.yBounds())},a.prototype.xBounds=function(){var a,b;return a=this.rotation,b=Math.atan(-this.radius2*Math.tan(a)/this.radius1),[b,b+Math.PI].map(function(b){return function(c){return b.x+b.radius1*Math.cos(c)*Math.cos(a)-b.radius2*Math.sin(c)*Math.sin(a)}}(this))},a.prototype.yBounds=function(){var a,b;return a=this.rotation,b=Math.atan(this.radius2*(Math.cos(a)/Math.sin(a))/this.radius1),[b,b+Math.PI].map(function(b){return function(c){return b.y+b.radius1*Math.cos(c)*Math.sin(a)+b.radius2*Math.sin(c)*Math.cos(a)}}(this))},a.prototype.translate=function(a,b){var c,d;return d=o.pointFrom(a,b),c=d.x,b=d.y,this.x+=c,this.y+=b,this},a.prototype.rotate=function(a){return this.rotation+=a,this},a.prototype.scale=function(a){return this.radius1*=a,this.radius2*=a,this},a.prototype.points=function(){var a;return this.memoized("points")&&this.memoFor("points").concat(),this.memoize("points",function(){var b,c,d;for(d=[],a=b=0,c=this.segments;c>=0?c>=b:b>=c;a=c>=0?++b:--b)d.push(this.pathPointAt(a/this.segments));return d}.call(this))},a.prototype.triangles=function(){var a,b,c,d,e,f;if(this.memoized("triangles"))return this.memoFor("triangles");for(d=[],c=this.points(),a=this.center(),b=e=1,f=c.length-1;f>=1?f>=e:e>=f;b=f>=1?++e:--e)d.push(new u(a,c[b-1],c[b]));return this.memoize("triangles",d)},a.prototype.closedGeometry=function(){return!0},a.prototype.pointAtAngle=function(a){var b,c,d,e;return b=a-this.rotation,d=this.radius1/this.radius2,e=new o(Math.cos(b)*this.radius1,Math.sin(b)*this.radius1),this.radius1<this.radius2&&(e.x=e.x/d),this.radius1>this.radius2&&(e.y=e.y*d),b=e.angle(),c=new o(Math.cos(b)*this.radius1,Math.sin(b)*this.radius2),this.center().add(c.rotate(this.rotation))},a.prototype.acreage=function(){return Math.PI*this.radius1*this.radius2},a.prototype.randomPointInSurface=function(a){var b,c,d;return null==a&&(a=new a.Random(new a.MathRandom)),d=this.pathPointAt(a.get()),b=this.center(),c=d.subtract(b),b.add(c.scale(Math.sqrt(a.random())))},a.prototype.contains=function(a,b){var c,d,e,f,g;return f=new o(a,b),d=this.center(),e=f.subtract(d),c=e.angle(),g=this.pointAtAngle(c),d.distance(g)>=d.distance(f)},a.prototype.length=function(){return Math.PI*(3*(this.radius1+this.radius2)-Math.sqrt((3*this.radius1+this.radius2)*(this.radius1+3*this.radius2)))},a.prototype.pathPointAt=function(a){var b,c;return b=a*Math.PI*2,c=new o(Math.cos(b)*this.radius1,Math.sin(b)*this.radius2),this.center().add(c.rotate(this.rotation))},a.prototype.drawPath=function(a){return a.save(),a.translate(this.x,this.y),a.rotate(this.rotation),a.scale(this.radius1,this.radius2),a.beginPath(),a.arc(0,0,1,0,2*Math.PI),a.closePath(),a.restore()},a.prototype.memoizationKey=function(){return""+this.radius1+";"+this.radius2+";"+this.x+";"+this.y+";"+this.rotation+";"+this.segments},a}(),S=w.geom,o=S.Point,f=S.Intersections,d=S.Geometry,s=S.Spline,n=S.Path,w.geom.LinearSpline=function(){function a(a,b){this.initSpline(a,b)}return a.include(E.Formattable("LinearSpline")),a.include(E.Sourcable("agt.geom.LinearSpline","vertices","bias")),a.include(d),a.include(n),a.include(f),a.include(s(1)),a.prototype.points=function(){var a,b,c,d,e;for(d=this.vertices,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.clone());return e},a.prototype.segments=function(){return this.vertices.length-1},a.prototype.validateVertices=function(a){return a.length>=2},a.prototype.drawVerticesConnections=function(){},a}(),o=w.geom.Point,w.geom.Matrix=function(){function a(a,b,c,d,e,f){var g;null==a&&(a=1),null==b&&(b=0),null==c&&(c=0),null==d&&(d=1),null==e&&(e=0),null==f&&(f=0),g=this.matrixFrom(a,b,c,d,e,f,!0),this.a=g.a,this.b=g.b,this.c=g.c,this.d=g.d,this.tx=g.tx,this.ty=g.ty}var b;return b=["a","b","c","d","tx","ty"],a.include(E.Equatable.apply(E,b)),a.include(E.Formattable.apply(E,["Matrix"].concat(b))),a.include(E.Sourcable.apply(E,["agt.geom.Matrix"].concat(b))),a.include(E.Parameterizable("matrixFrom",{a:1,b:0,c:0,d:1,tx:0,ty:0})),a.include(E.Cloneable()),a.isMatrix=function(a){var b,c,d;if(null==a)return!1;for(c=0,d=PROPERTIES.length;d>c;c++)if(b=PROPERTIES[c],!Math.isFloat(a[b]))return!1;return!0},a.prototype.transformPoint=function(a,b){var c,d;if(null==a&&null==b)throw new Error("transformPoint was called without arguments");return d=o.pointFrom(a,b,!0),c=d.x,b=d.y,new o(c*this.a+b*this.c+this.tx,c*this.b+b*this.d+this.ty)},a.prototype.translate=function(a,b){var c,d;return null==a&&(a=0),null==b&&(b=0),d=o.pointFrom(a,b),c=d.x,b=d.y,this.tx+=c,this.ty+=b,this},a.prototype.scale=function(a,b){var c,d;return null==a&&(a=1),null==b&&(b=1),d=o.pointFrom(a,b),c=d.x,b=d.y,this.a*=c,this.d*=b,this.tx*=c,this.ty*=b,this},a.prototype.rotate=function(a){var b,c,d;return null==a&&(a=0),b=Math.cos(a),c=Math.sin(a),d=[this.a*b-this.b*c,this.a*c+this.b*b,this.c*b-this.d*c,this.c*c+this.d*b,this.tx*b-this.ty*c,this.tx*c+this.ty*b],this.a=d[0],this.b=d[1],this.c=d[2],this.d=d[3],this.tx=d[4],this.ty=d[5],this},a.prototype.skew=function(a,b){var c;return c=o.pointFrom(a,b,0),this.append(Math.cos(c.y),Math.sin(c.y),-Math.sin(c.x),Math.cos(c.x))},a.prototype.append=function(a,b,c,d,e,f){var g,h;return null==a&&(a=1),null==b&&(b=0),null==c&&(c=0),null==d&&(d=1),null==e&&(e=0),null==f&&(f=0),g=this.matrixFrom(a,b,c,d,e,f,!0),a=g.a,b=g.b,c=g.c,d=g.d,e=g.tx,f=g.ty,h=[a*this.a+b*this.c,a*this.b+b*this.d,c*this.a+d*this.c,c*this.b+d*this.d,e*this.a+f*this.c+this.tx,e*this.b+f*this.d+this.ty],this.a=h[0],this.b=h[1],this.c=h[2],this.d=h[3],this.tx=h[4],this.ty=h[5],this},a.prototype.prepend=function(a,b,c,d,e,f){var g,h,i;return null==a&&(a=1),null==b&&(b=0),null==c&&(c=0),null==d&&(d=1),null==e&&(e=0),null==f&&(f=0),g=this.matrixFrom(a,b,c,d,e,f,!0),a=g.a,b=g.b,c=g.c,d=g.d,e=g.tx,f=g.ty,(1!==a||0!==b||0!==c||1!==d)&&(h=[this.a*a+this.b*c,this.a*b+this.b*d,this.c*a+this.d*c,this.c*b+this.d*d],this.a=h[0],this.b=h[1],this.c=h[2],this.d=h[3]),i=[this.tx*a+this.ty*c+e,this.tx*b+this.ty*d+f],this.tx=i[0],this.ty=i[1],this},a.prototype.identity=function(){var a;return a=[1,0,0,1,0,0],this.a=a[0],this.b=a[1],this.c=a[2],this.d=a[3],this.tx=a[4],this.ty=a[5],this},a.prototype.inverse=function(){var a,b;return a=this.a*this.d-this.b*this.c,b=[this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.ty-this.d*this.tx)/a,-(this.a*this.ty-this.b*this.tx)/a],this.a=b[0],this.b=b[1],this.c=b[2],this.d=b[3],this.tx=b[4],this.ty=b[5],this},a.prototype.isMatrix=function(b){return a.isMatrix(b)},a}(),T=w.geom,o=T.Point,v=T.Triangulable,d=T.Geometry,t=T.Surface,n=T.Path,f=T.Intersections,w.geom.Polygon=function(){function a(a){a=this.polygonFrom(a).vertices,null==a&&this.noVertices(),a.length<3&&this.notEnougthVertices(a),this.vertices=a}return a.extend(E.Aliasable),a.include(E.Formattable("Polygon","vertices")),a.include(E.Sourcable("agt.geom.Polygon","vertices")),a.include(E.Cloneable()),a.include(d),a.include(f),a.include(v),a.include(t),a.include(n),a.polygonFrom=function(a){var b;return null!=a&&"object"==typeof a?(b=-1!==Object.prototype.toString.call(a).indexOf("Array"),b?{vertices:a}:a):{vertices:null}},a.prototype.center=function(){var a,b,c,d,e,f;for(b=c=0,f=this.vertices,d=0,e=f.length;e>d;d++)a=f[d],b+=a.x,c+=a.y;return b/=this.vertices.length,c/=this.vertices.length,new o(b,c)},a.prototype.translate=function(a,b){var c,d,e,f,g;for(f=o.pointFrom(a,b),a=f.x,b=f.y,g=this.vertices,d=0,e=g.length;e>d;d++)c=g[d],c.x+=a,c.y+=b;return this},a.prototype.rotate=function(a){var b,c,d,e,f,g;for(b=this.center(),g=this.vertices,c=e=0,f=g.length;f>e;c=++e)d=g[c],this.vertices[c]=d.rotateAround(b,a);return this},a.alias("rotate","rotateAroundCenter"),a.prototype.scale=function(a){var b,c,d,e,f,g;for(b=this.center(),g=this.vertices,c=e=0,f=g.length;f>e;c=++e)d=g[c],this.vertices[c]=b.add(d.subtract(b).scale(a));return this},a.alias("scale","scaleAroundCenter"),a.prototype.points=function(){var a;return function(){var b,c,d,e;for(d=this.vertices,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.clone());return e}.call(this).concat(this.vertices[0].clone())},a.prototype.closedGeometry=function(){return!0},a.prototype.pointAtAngle=function(a){var b,c,d,e;return b=this.center(),c=function(a,c){return a.distance(b)-c.distance(b)},d=b.add(1e4*Math.cos(a),1e4*Math.sin(a)),null!=(e=this.intersections({points:function(){return[b,d]}}))?e.sort(c)[0]:void 0},a.prototype.acreage=function(){var a,b,c,d,e;for(a=0,e=this.triangles(),c=0,d=e.length;d>c;c++)b=e[c],a+=b.acreage();return a},a.prototype.contains=function(a,b){var c,d,e,f;for(f=this.triangles(),d=0,e=f.length;e>d;d++)if(c=f[d],c.contains(a,b))return!0;return!1},a.prototype.randomPointInSurface=function(a){var b,c,d,e,f,g,h;for(null==a&&(a=new chancejs.Random(new chancejs.MathRandom)),b=this.acreage(),f=this.triangles(),e=f.map(function(a){return a.acreage()/b}),c=g=0,h=e.length;h>g;c=++g)d=e[c],c>0&&(e[c]+=e[c-1]);return a.inArray(f,e,!0).randomPointInSurface(a)},a.prototype.length=function(){var a,b,c,d,e;for(b=0,c=this.points(),a=d=1,e=c.length-1;e>=1?e>=d:d>=e;a=e>=1?++d:--d)b+=c[a-1].distance(c[a]);return b},a.prototype.memoizationKey=function(){return this.vertices.map(function(a){return""+a.x+","+a.y}).join(";")},a.prototype.polygonFrom=a.polygonFrom,a.prototype.noVertices=function(){throw new Error("No vertices provided to Polygon")},a.prototype.notEnougthVertices=function(a){var b;throw b=a.length,new Error("Polygon must have at least 3 vertices, was "+b)},a}(),U=w.geom,o=U.Point,f=U.Intersections,d=U.Geometry,s=U.Spline,n=U.Path,w.geom.QuadBezier=function(){function a(a,b){null==b&&(b=20),this.initSpline(a,b)}return a.include(E.Formattable("QuadBezier")),a.include(E.Sourcable("agt.geom.QuadBezier","vertices","bias")),a.include(d),a.include(n),a.include(f),a.include(s(2)),a.prototype.pointInSegment=function(a,b){var c;return c=new o,c.x=b[0].x*this.b1(a)+b[1].x*this.b2(a)+b[2].x*this.b3(a),c.y=b[0].y*this.b1(a)+b[1].y*this.b2(a)+b[2].y*this.b3(a),c},a.prototype.b1=function(a){return(1-a)*(1-a)},a.prototype.b2=function(a){return 2*a*(1-a)},a.prototype.b3=function(a){return a*a},a}(),V=w.geom,o=V.Point,f=V.Intersections,d=V.Geometry,s=V.Spline,n=V.Path,w.geom.QuintBezier=function(){function a(a,b){null==b&&(b=20),this.initSpline(a,b)}return a.include(E.Formattable("QuintBezier")),a.include(E.Sourcable("agt.geom.QuintBezier","vertices","bias")),a.include(d),a.include(n),a.include(f),a.include(s(4)),a.prototype.pointInSegment=function(a,b){var c;return c=new o,c.x=b[0].x*this.b1(a)+b[1].x*this.b2(a)+b[2].x*this.b3(a)+b[3].x*this.b4(a)+b[4].x*this.b5(a),c.y=b[0].y*this.b1(a)+b[1].y*this.b2(a)+b[2].y*this.b3(a)+b[3].y*this.b4(a)+b[4].y*this.b5(a),c},a.prototype.b1=function(a){return(1-a)*(1-a)*(1-a)*(1-a)},a.prototype.b2=function(a){return 4*a*(1-a)*(1-a)*(1-a)},a.prototype.b3=function(a){return 6*a*a*(1-a)*(1-a)},a.prototype.b4=function(a){return 4*a*a*a*(1-a)},a.prototype.b5=function(a){return a*a*a*a},a}(),M=w.geom,o=M.Point,c=M.Ellipsis,d=M.Geometry,n=M.Path,f=M.Intersections,w.geom.Spiral=function(){function a(a,b,c,d,e,f,g){var h;h=this.spiralFrom(a,b,c,d,e,f,g),this.radius1=h.radius1,this.radius2=h.radius2,this.twirl=h.twirl,this.x=h.x,this.y=h.y,this.rotation=h.rotation,this.segments=h.segments}var b,e;return e=["radius1","radius2","twirl","x","y","rotation","segments"],a.include(E.Equatable.apply(null,e)),a.include(E.Formattable.apply(null,["Spiral"].concat(e))),a.include(E.Parameterizable("spiralFrom",{radius1:1,radius2:1,twirl:1,x:0,y:0,rotation:0,segments:36})),a.include(E.Sourcable.apply(null,["agt.geom.Spiral"].concat(e))),a.include(E.Cloneable()),a.include(E.Memoizable),a.include(d),a.include(n),a.include(f),a.prototype.center=function(){return new o(this.x,this.y)},a.prototype.ellipsis=function(){return this.memoized("ellipsis")?this.memoFor("ellipsis"):this.memoize("ellipsis",new c(this))},a.prototype.translate=function(a,b){var c;return c=o.pointFrom(a,b),a=c.x,b=c.y,this.x+=a,this.y+=b,this},a.prototype.rotate=function(a){return this.rotation+=a,this},a.prototype.scale=function(a){return this.radius1*=a,this.radius2*=a,this},a.prototype.points=function(){var a,b,c,d,e,f,g;if(this.memoized("points"))return this.memoFor("points").concat();for(e=[],a=this.center(),b=this.ellipsis(),c=f=0,g=this.segments;g>=0?g>=f:f>=g;c=g>=0?++f:--f)d=c/this.segments,e.push(this.pathPointAt(d));return this.memoize("points",e)},a.prototype.pathPointAt=function(a,b){var c,d,e,f,g,h;return null==b&&(b=!0),e=this.center(),f=this.ellipsis(),c=2*Math.PI,d=this.rotation+a*c*this.twirl%c,g=null!=(h=f.pointAtAngle(d))?h.subtract(e).scale(a):void 0,e.add(g)},a.prototype.fill=function(){},a.prototype.drawPath=function(a){var b,c,d,e,f,g;for(c=this.points(),d=c.shift(),a.beginPath(),a.moveTo(d.x,d.y),g=[],e=0,f=c.length;f>e;e++)b=c[e],g.push(a.lineTo(b.x,b.y));return g},b=function(){return""+this.radius1+";"+this.radius2+";"+this.twirl+";"+this.x+";"+this.y+";"+this.rotation+";"+this.segments},a}(),o=w.geom.Point,w.geom.TransformationProxy=function(){function a(a,b){this.geometry=a,this.matrix=b,this.proxiedMethods=this.detectProxyableMethods(this.geometry)}return a.defineProxy=function(a,b){switch(b){case"PointList":return this.prototype[a]=function(){var b;return b=this.geometry[a].apply(this.geometry,arguments),null!=this.matrix?b.map(function(a){return function(b){return a.matrix.transformPoint(b)}}(this)):b};case"Point":return this.prototype[a]=function(){var b;return b=this.geometry[a].apply(this.geometry,arguments),null!=this.matrix?this.matrix.transformPoint(b):b};case"Angle":return this.prototype[a]=function(){var b,c;return b=this.geometry[a].apply(this.geometry,arguments),null!=this.matrix?(c=new o(Math.cos(b),Math.sin(b)),this.matrix.transformPoint(c).angle()):b}}},a.prototype.proxied=function(){var a,b,c,d;c=this.proxiedMethods,d=[];for(a in c)b=c[a],d.push(a);return d},a.prototype.detectProxyableMethods=function(b){var c,d,e,f;d={},f=b.constructor.prototype;for(c in f)e=f[c],e.proxyable&&(d[c]=e.proxyable,a.defineProxy(c,e.proxyable));return d},a}(),o=w.geom.Point,w.particles.Particle=function(){function a(){}return a.concern(w.mixins.Poolable),a.prototype.init=function(a){var b,c,d;null==a&&(a={}),this.dead=!1,this.life=0,this.maxLife=0,this.position=new o,this.lastPosition=new o,this.velocity=new o,this.parasite={},d=[];for(b in a)c=a[b],d.push(this[b]=c);return d},a.prototype.dispose=function(){return this.position=null,this.lastPosition=null,this.velocity=null,this.parasite=null},a.prototype.die=function(){return this.dead=!0,this.life=this.maxLife},a.prototype.revive=function(){return this.dead=!1,this.life=0},a}(),m=w.particles.Particle,l=w.particles.timers.NullTimer,i=w.particles.counters.NullCounter,j=w.particles.emitters.NullEmitter,w.particles.Emission=function(){function a(a,b,c,d,e){this.particleType=null!=a?a:m,this.emitter=null!=b?b:new j,this.timer=null!=c?c:new l,this.counter=null!=d?d:new i,this.initializer=null!=e?e:null}return a.prototype.prepare=function(a,b,c){var d;return this.timer.prepare(a,b,c),d=this.timer.nextTime,this.counter.prepare(d,d/1e3,c),this.currentCount=this.counter.count,this.currentTime=d,this.iterator=0},a.prototype.hasNext=function(){return this.iterator<this.currentCount},a.prototype.next=function(){var a,b;return a=this.particleType.get({position:this.emitter.get()}),null!=(b=this.initializer)&&b.initialize(a),this.iterator++,a},a.prototype.nextTime=function(){return this.currentTime-this.iterator/this.currentCount*this.currentTime},a.prototype.finished=function(){return this.timer.finished()},a}(),r=w.Signal,e=w.Impulse,k=w.particles.initializers.NullInitializer,h=w.particles.actions.NullAction,w.particles.System=function(){function a(a,b,c){this.initializer=null!=a?a:new k,this.action=null!=b?b:new h,this.subSystem=c,this.particlesCreated=new r,this.particlesDied=new r,this.emissionStarted=new r,this.emissionFinished=new r,this.particles=[],this.emissions=[]}return a.prototype.emit=function(a){return this.emissions.push(a),a.system=this,this.startEmission(a)},a.prototype.startEmission=function(a){return a.prepare(0,0,this.getTime()),this.created=[],this.died=[],this.running||this.start(),this.processEmission(a),this.emissionStarted.dispatch(this,a),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},a.prototype.start=function(){return this.running?void 0:(e.instance().add(this.tick,this),this.running=!0)},a.prototype.stop=function(){return this.running?(e.instance().remove(this.tick,this),this.running=!1):void 0},a.prototype.tick=function(a,b,c){return this.died=[],this.created=[],this.processParticles(a,b,c),this.emitting()&&this.processEmissions(a,b,c),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},a.prototype.emitting=function(){return this.emissions.length>0},a.prototype.processEmissions=function(a,b,c){var d,e,f,g,h;for(g=this.emissions.concat(),h=[],e=0,f=g.length;f>e;e++)d=g[e],d.prepare(a,b,c),h.push(this.processEmission(d));return h},a.prototype.processEmission=function(a){var b,c,d;for(d=[];a.hasNext();)c=a.nextTime(),b=a.next(),this.created.push(b),this.registerParticle(b),this.initializeParticle(b,c),a.finished()?(this.removeEmission(a),d.push(this.emissionFinished.dispatch(this,a))):d.push(void 0);return d},a.prototype.removeEmission=function(a){return this.emissions.splice(this.emissions.indexOf(a),1)},a.prototype.processParticles=function(a,b,c){var d,e,f,g,h;for(this.action.prepare(a,b,c),g=this.particles.concat(),h=[],e=0,f=g.length;f>e;e++)d=g[e],this.action.process(d),h.push(d.dead?this.unregisterParticle(d):void 0);return h},a.prototype.initializeParticle=function(a,b){return this.initializer.initialize(a),this.action.prepare(b,b/1e3,this.getTime()),this.action.process(a),a.dead?this.unregisterParticle(a):void 0},a.prototype.registerParticle=function(a){return this.particles.push(a)},a.prototype.unregisterParticle=function(a){var b;return this.died.push(a),null!=(b=this.subSystem)&&b.emitFor(a),this.particles.splice(this.particles.indexOf(a),1),a.constructor.release(a)},a.prototype.getTime=function(){return(new Date).valueOf()},a}(),w.particles.SubSystem=function(a){function b(a,c,d,e){this.emissionFactory=d,b.__super__.constructor.call(this,a,c,e)}return Z(b,a),b.prototype.emitFor=function(a){return this.emit(this.emissionFactory(a))},b}(w.particles.System),N=w.random,q=N.Random,g=N.MathRandom,a=new q(new g),w.particles.Randomizable=function(){function b(){}return b.prototype.initRandom=function(){return this.random||(this.random=a)},b}(),w.particles.actions.BaseAction=function(){function a(){}return a.prototype.prepare=function(a,b,c){this.bias=a,this.biasInSeconds=b,this.time=c},a}(),w.particles.actions.DieOnSurface=function(){function a(a){this.surfaces=a,-1===Object.prototype.toString.call(this.surface).indexOf("Array")&&(this.surfaces=[this.surfaces])}return a.prototype.prepare=function(){},a.prototype.process=function(a){var b,c,d,e;for(e=this.surfaces,c=0,d=e.length;d>c;c++)if(b=e[c],b.contains(a.position))return a.die()},a}(),w.particles.actions.Force=function(a){function b(a){this.vector=null!=a?a:new w.geom.Point}return Z(b,a),b.prototype.process=function(a){return a.velocity.x+=this.vector.x*this.biasInSeconds,a.velocity.y+=this.vector.y*this.biasInSeconds},b}(w.particles.actions.BaseAction),w.particles.actions.Friction=function(a){function b(a){this.amount=null!=a?a:1}return Z(b,a),b.prototype.process=function(a){var b,c;return b=a.velocity.x*this.biasInSeconds*this.amount,c=a.velocity.y*this.biasInSeconds*this.amount,a.velocity.x-=b,a.velocity.y-=c},b}(w.particles.actions.BaseAction),w.particles.actions.Live=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Z(b,a),b.prototype.process=function(a){return a.life+=this.bias,a.life>=a.maxLife?a.die():void 0},b}(w.particles.actions.BaseAction),w.particles.actions.MacroAction=function(a){function b(a){this.actions=null!=a?a:[]}return Z(b,a),b.prototype.prepare=function(a,b,c){var d,e,f,g,h;for(g=this.actions,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.prepare(a,b,c));return h},b.prototype.process=function(a){var b,c,d,e,f;for(e=this.actions,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.process(a));return f},b}(w.particles.actions.BaseAction),w.particles.actions.Move=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Z(b,a),b.prototype.process=function(a){return a.lastPosition.x=a.position.x,a.lastPosition.y=a.position.y,a.position.x+=a.velocity.x*this.biasInSeconds,a.position.y+=a.velocity.y*this.biasInSeconds},b}(w.particles.actions.BaseAction),w.particles.actions.NullAction=function(){function a(){}return a.prototype.prepare=function(){},a.prototype.process=function(){},a}(),w.particles.counters.ByRate=function(){function a(a){this.rate=null!=a?a:1,this.count=0,this.rest=0,this.offset=1}return a.prototype.prepare=function(a,b){return this.rest+=b*this.rate,this.count=Math.floor(this.rest),this.rest-=this.count,this.count+=this.offset,this.offset=0},a}(),w.particles.counters.Fixed=function(){function a(a){this.count=null!=a?a:1}return a.prototype.prepare=function(){},a}(),w.particles.counters.NullCounter=function(){function a(){}return a.prototype.count=0,a.prototype.prepare=function(){},a}(),w.particles.emitters.NullEmitter=function(){function a(){}return a.prototype.get=function(){return new w.geom.Point},a}(),w.particles.emitters.Path=function(){function a(a,b){this.path=a,this.random=b,this.initRandom()}return a.include(w.particles.Randomizable),a.prototype.get=function(){return this.path.pathPointAt(this.random.get())},a}(),w.particles.emitters.Ponctual=function(){function a(a){this.point=null!=a?a:new w.geom.Point}return a.prototype.get=function(){return this.point.clone()},a}(),w.particles.emitters.Surface=function(){function a(a,b){this.surface=a,this.random=b,this.initRandom()}return a.include(w.particles.Randomizable),a.prototype.get=function(){return this.surface.randomPointInSurface(this.random)},a}(),w.particles.initializers.Explosion=function(){function a(a,b,c,d,e){this.velocityMin=null!=a?a:0,this.velocityMax=null!=b?b:1,this.angleMin=null!=c?c:0,this.angleMax=null!=d?d:2*Math.PI,this.random=e,this.initRandom()}return a.include(w.particles.Randomizable),a.prototype.initialize=function(a){var b,c;return b=this.random["in"](this.angleMin,this.angleMax),c=this.random["in"](this.velocityMin,this.velocityMax),a.velocity.x=Math.cos(b)*c,a.velocity.y=Math.sin(b)*c},a}(),w.particles.initializers.Life=function(){function a(a,b,c){this.lifeMin=a,this.lifeMax=b,this.random=c,null==this.lifeMax&&(this.lifeMax=this.lifeMin),this.initRandom()}return a.include(w.particles.Randomizable),a.prototype.initialize=function(a){return a.maxLife=this.lifeMin===this.lifeMax?this.lifeMin:this.random["in"](this.lifeMin,this.lifeMax)},a}(),w.particles.initializers.MacroInitializer=function(){function a(a){this.initializers=a}return a.prototype.initialize=function(a){var b,c,d,e,f;for(e=this.initializers,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.initialize(a));return f},a}(),w.particles.initializers.NullInitializer=function(){function a(){}return a.prototype.initialize=function(){},a}(),w.particles.initializers.ParticleSubSystem=function(){function a(a,b,c,d){this.subSystem=new w.particles.SubSystem(a,b,c,d)}return a.prototype.initialize=function(a){return this.subSystem.emitFor(a)},a}(),w.particles.initializers.Stream=function(){function a(a,b,c,d,e){this.direction=null!=a?a:new w.geom.Point(1,1),this.velocityMin=null!=b?b:0,this.velocityMax=null!=c?c:1,this.angleRandom=null!=d?d:0,this.random=e,this.initRandom()}return a.include(w.particles.Randomizable),a.prototype.initialize=function(a){var b,c;return c=this.random["in"](this.velocityMin,this.velocityMax),b=this.direction.angle(),0!==this.angleRandom&&(b+=this.random.pad(this.angleRandom)),a.velocity.x=Math.cos(b)*c,a.velocity.y=Math.sin(b)*c},a}(),w.particles.timers.Instant=function(){function a(){}return a.prototype.prepare=function(){},a.prototype.finished=function(){return!0},a.prototype.nextTime=function(){return 0},a}(),w.particles.timers.Limited=function(){function a(a,b){this.duration=null!=a?a:1e3,this.since=null!=b?b:0,this.time=0,this.nextTime=0}return a.prototype.prepare=function(a){return this.firstTime?this.nextTime=a:(this.nextTime=this.since+a,this.firstTime=!0),this.time+=a},a.prototype.finished=function(){return this.time>=this.duration},a}(),w.particles.timers.NullTimer=function(){function a(){}return a.prototype.nextTime=0,a.prototype.prepare=function(){},a.prototype.finished=function(){return!0},a}(),w.particles.timers.Unlimited=function(a){function b(a){b.__super__.constructor.call(this,1/0,a)}return Z(b,a),b.prototype.finished=function(){return!1},b}(w.particles.timers.Limited),w.particles.timers.UntilDeath=function(){function a(a){this.particle=a}return a.prototype.prepare=function(a){return this.nextTime=a},a.prototype.finished=function(){return this.particle.dead},a}()}).call(this);